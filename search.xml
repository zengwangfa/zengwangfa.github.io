<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2025-10-25 夜</title>
      <link href="/2025/10/25/2025-10-25/"/>
      <url>/2025/10/25/2025-10-25/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="18f71f50079b5d7c55c7b5eb5c9bd5ffaa2adbcf216dad24dd206b09802da49e">1d621d107eecb08cb114bf54a2314bea723a2c7b8164d6013b25394e581f3bffb64b59fff7f99486dee0dda40f4112e8e75409406852a0b6cc66d520a2c348b64730efd32832c556e16bea30a388e387c4479b2a6250b5b81449527d5a07baf4f16f00ce5a5d00d4eb6ee6295d573a650626446b23ebea033a7eb6dcc8ad9ab67b27c46704feff8cbe2f659f2932f6019eac2896daebfc6d0929906e162bbd26119bf0d175f444836ad40e7df9aec40f4d1ce062ffd14101c7ff623757b78cb8a50b215d77f008250ef1d78b3903d50c9fde4491410bb73136f8cb77ff8debe3f82fdf99528596dbc48207cccab8b9fa3dd1d1f6ecd341bdaed7dd2cf4af56ea67315d7d262712e90d6244ce3672fa789e8531059517d451771eb1211276a357d03f99d3267a323117fbe223d2aeacbdc1abbe8f924b31947b09c75bca30ed6833f503fe4613509ddab4224ff2854773a582c5bb72d0412b41b3ad852c3bf57dffe9cea89b7820699ae64184ba8eec81e18eca258208a4ac9d943a133273843b712f96b969a4770413f5ef8268ff5b606ce93fc171c5a02d32f0a65b77d2b8471b7a3db05442cfb5f98694d9ad763ee48e108cc5cf8bccc408ca18e89e79c8dd6031d71533aa89c5152268ac1900c5c3f1e982879cbe5057cb2f47c533f10486cbe68cf09bb5d1b3cbad88173a6527609fb9e5bfe2d067377250b98e3059a77f3dc3c912081f13af46a1fe65506e7f5e7e4bb275d251f436ce6df3fde937f472210c5ba38a6dcacfc5e3b7453fb1b1d3ab109e9fbdaeaf80cfc118126f2094e746e24d1d22f7dc4aed811014aaf46560161ce9db66c58b8070b4dadd1b2f96551af868e058ef03e9357e090d398f34d594047c2a09b6a01d9b30344ab8cd5a726536f8f7285d6174a303adeab15def9004aecec1724c0c9bbd86c9b8d874746bd00ba8ddce281929742db82e9c79ba0e35e1fe12bd3a5c059170392e5a09fb206173344f89dffcf72a930c009671ac3d7a94b0be1d84ea19d0a29d6d16fadaadd55fc406eaaa216c195beff608a7e364242cf0e91cc93fb62b9d74e3e0ce16f2976319bdd7b418ff20711f273741b9b6c7824cf1706d9ad2da1292c9e777d6e698ac9d171412d2d9e9625096fd967882b48b9199332285d6d9974fb47eb04c3f44bd7cb10c981080e80e728ce4dae18fa01c1dbf5871f95045e9d4d1a4be45b6b507e3a6d08d5af2b10e574425a82399e85985860c44fefbd93b2be1035512ba</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请输入密码访问</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LCD硬件原理及初始化</title>
      <link href="/2019/12/31/s3c2440-lcd/"/>
      <url>/2019/12/31/s3c2440-lcd/</url>
      
        <content type="html"><![CDATA[<h2 id="1-LCD与OLED的区别"><a href="#1-LCD与OLED的区别" class="headerlink" title="1.LCD与OLED的区别"></a>1.LCD与OLED的区别</h2><ul><li><p><strong>LCD背光源与OLED自发光</strong></p></li><li><p>LCD无机材料，LCD寿命较长。OLED广视角、几乎无穷高的对比度、可以弯曲、较低耗电优点。<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd&amp;oled.png" alt="LCD与OLED结构差异"></p></li></ul><h2 id="2-LCD原理"><a href="#2-LCD原理" class="headerlink" title="2.LCD原理"></a>2.LCD原理</h2><ul><li>屏幕上的每一个点称为像素</li><li>每个像素点由RGB三原色组成<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_scan.gif" alt="LCD Display a picture"></li></ul><h3 id="2-1-颜色如何确定？"><a href="#2-1-颜色如何确定？" class="headerlink" title="2.1 颜色如何确定？"></a>2.1 颜色如何确定？</h3><ul><li>由RGB三组信号线组成</li><li>由下原理图可知：R5条、G6条，B5条，即<code>RGB565</code>（彩色模式, <strong>一个像素占两个字节</strong>）</li><li>因此其每个像素占用多少位（<strong>BBP</strong>：bit per piexl）为2个字节<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_circuit.png" alt=""></li></ul><h3 id="2-2-LCD如何“行扫描”？"><a href="#2-2-LCD如何“行扫描”？" class="headerlink" title="2.2 LCD如何“行扫描”？"></a>2.2 LCD如何“行扫描”？</h3><ul><li>有一条CLK时钟线与LCD相连，每发出一次CLK(高低电平)，就移动一个像素。</li></ul><h3 id="2-3-如何跳到下一行进行“行扫描”？"><a href="#2-3-如何跳到下一行进行“行扫描”？" class="headerlink" title="2.3 如何跳到下一行进行“行扫描”？"></a>2.3 如何跳到下一行进行“行扫描”？</h3><ul><li>有一条HSYNC（<strong>水平同步信号</strong>）信号线与LCD相连，每发出一次脉冲(高低电平)，行扫描跳到下一行的起始位置。</li></ul><h3 id="2-4-如何进行下一个“场扫描”？"><a href="#2-4-如何进行下一个“场扫描”？" class="headerlink" title="2.4 如何进行下一个“场扫描”？"></a>2.4 如何进行下一个“场扫描”？</h3><ul><li>有一条VSYNC（<strong>垂直同步信号</strong>）信号线与LCD相连，每发出一次脉冲(高低电平)，就跳到原点。</li></ul><hr><blockquote><p>注意：RGB数据线上的数据从何而来？<br>内存里面手动划分一块显存(FrameBuffer)，里面存放了要显示的数据，LCD控制器从里面将数据读出来，通过RGB三组线传给LCD，再依次打到显示屏上。</p></blockquote><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_pin.png" alt="信号引脚标"></p><h2 id="3-LCD时序"><a href="#3-LCD时序" class="headerlink" title="3.LCD时序"></a>3.LCD时序</h2><ul><li>分辨率 = Hsync的个数 * 一行中的有效CLK</li></ul><p>完整时序图：<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_timing_diagram.png" alt="完整时序图"><br>形象时序图：<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_timing_xy.png" alt="形象时序图"></p><blockquote><p>以上两张图可以解释LCD控制时序中的<code>Hsync</code>与<code>Vsync</code>的协同（可以理解 一帧是一个垂直同步信号、一行是一个水平同步信号）</p><ul><li>1.首先一帧（Vsync）中有若干个行（Hsync），设为y，Vsync发出帧脉冲宽度<code>Tvp</code></li><li>2.经过 <code>Tvb</code> 时间，才可以发送一帧的数据，从第一行开始</li><li>3.其次一行（Hsync）中有若干个时钟信号（CLK），有效的设为x，Hsync发出脉冲宽度<code>Thp</code></li><li>4.经过 <code>Thb</code> 时间，才可以发送一行的数据</li><li>5.直到发送到一行的最后一个像素，经过 <code>Thf</code> 时间，才会有下一个水平同步信号（Hsync）</li><li>6.直到发送到最后一行，经过 <code>Tvf</code> 时间，才会有下一个垂直同步信号（Vsync）</li></ul></blockquote><p><strong>由上可知几个重要的信号引脚</strong>：<code>Hsync</code>、<code>Vsync</code> 、<code>CLK</code>、<code>Dn</code><br><strong>由上可知几个重要的时间参数</strong>：<code>Tvp</code>、<code>Tvb</code> 、<code>Thp</code>、<code>Thb</code>、<code>Thf</code> 、<code>Tvf</code> </p><h2 id="4-LCD控制器"><a href="#4-LCD控制器" class="headerlink" title="4.LCD控制器"></a>4.LCD控制器</h2><p>思路：</p><ul><li>1.取数据：把<code>FrameBuffer</code>的地址、<code>bpp</code>、<code>分辨率</code>告诉LCD控制器</li><li>2.发数据：把时序告诉LCD控制器、并设置引脚的极性（本款是下降沿取数据，但是有的LCD是上升沿有效，因此需要设置极性）</li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_controller_diagram.png" alt="LCD结构图"></p><h3 id="4-1-像素数据格式"><a href="#4-1-像素数据格式" class="headerlink" title="4.1 像素数据格式"></a>4.1 像素数据格式</h3><ul><li>使用的像素数格式如下：16BPP<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_data_format.png" alt="16BPP内存数据格式"></li></ul><p>565数据格式引脚连接图：<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/565_format_pin.png" alt="565数据格式引脚连接图"></p><h3 id="4-2-调色板"><a href="#4-2-调色板" class="headerlink" title="4.2 调色板"></a>4.2 调色板</h3><ul><li>本应该用<code>FrameBuffer</code>中用16bit表示1像素，可以用8bit存放在<code>FrameBuffer</code>来省空间</li><li>8bit存放的是调色板中颜色的索引（共256中16bit颜色）<blockquote><p>那么当使用像素深度为8pp时候，像素深度和我们的带宽不一致，我们的颜色要用16位表示，如果直接用上肯定不可能，那我们就可以选择用调色板，<strong>调色板中存放了256种16bpp的颜色</strong>，这时候我们color存放的就不是真实的颜色值了，而是存放的是调色板中256种颜色的<code>索引</code>，成线性关系一一对应，这样我们大大减轻了系统的负担。用16bpp还是8bpp这得取决实际情况，16bpp肯定比8pp清晰，但同时带来的负荷也更加重。</p></blockquote></li></ul><p>调色板工作示意图<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_palette.png" alt="调色板工作示意图"><br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_8bpp_fornat.png" alt="调色板8BPP"></p><h2 id="5-编程框架"><a href="#5-编程框架" class="headerlink" title="5.编程框架"></a>5.编程框架</h2><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_program_framework.png" alt="LCD编程框架"></p><p>面向对象编程<br>参数层：</p><ul><li>1.抽象出（不同设备）共同的参数结构体</li><li>2.上层的设备结构体指针指向所需的参数结构体</li></ul><hr><p>驱动层</p><ul><li>1.抽象不同平台的LCD控制器结构体</li><li>2.上层的LCD控制器结构体指针指向所需的结构体</li></ul><h2 id="6-结构体参数"><a href="#6-结构体参数" class="headerlink" title="6. 结构体参数"></a>6. 结构体参数</h2><h3 id="6-1-引脚极性结构体"><a href="#6-1-引脚极性结构体" class="headerlink" title="6.1 引脚极性结构体"></a>6.1 引脚极性结构体</h3><p>由上<a href="#3.LCD时序">3.LCD时序</a>可知几个重要的信号引脚：<code>Hsync</code>、<code>Vsync</code> 、<code>CLK</code>、<code>Dn</code>：<code>Hsync</code>、<code>Vsync</code> 、<code>CLK</code>、<code>Dn</code><br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/pins_polarity_reg.png" alt="引脚极性寄存器"></p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 引脚极性结构体 * NORMAL：正常极性 * INVERT：反转极性 */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> pins_polarity<span class="token punctuation">{</span>    <span class="token keyword">int</span> vclk<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">/* normal：下降沿获取数据 */</span>    <span class="token keyword">int</span> rgb<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">/* normal：高电平表示1 */</span>    <span class="token keyword">int</span> hsync<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* normal：高脉冲 */</span>    <span class="token keyword">int</span> vsync<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* normal：高脉冲 */</span><span class="token punctuation">}</span>pins_polarity<span class="token punctuation">,</span> <span class="token operator">*</span>p_pins_polarity<span class="token punctuation">;</span></code></pre><h3 id="6-2-时序结构体"><a href="#6-2-时序结构体" class="headerlink" title="6.2 时序结构体"></a>6.2 时序结构体</h3><p>由上<a href="#3.LCD时序">3.LCD时序</a>可知几个重要的时间参数：<code>Tvp</code>、<code>Tvb</code> 、<code>Thp</code>、<code>Thb</code>、<code>Thf</code> 、<code>Tvf</code> </p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 时序结构体 * NORMAL：正常极性 * INVERT：反转极性 */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> time_sequence<span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/* 垂直方向 */</span>    <span class="token keyword">int</span> tvp<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* Vsync脉冲宽度 */</span>    <span class="token keyword">int</span> tvb<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 上边黑框 Vertical Back porch */</span>    <span class="token keyword">int</span> tvf<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 下边黑框 Vertical Front porch */</span>    <span class="token comment" spellcheck="true">/* 水平方向 */</span>    <span class="token keyword">int</span> thp<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* Hsync脉冲宽度 */</span>    <span class="token keyword">int</span> thb<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 左边黑框 Horizontal Back porch*/</span>    <span class="token keyword">int</span> tvf<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 右边黑框 Horizontal Front porch */</span><span class="token punctuation">}</span>time_sequence<span class="token punctuation">,</span><span class="token operator">*</span>p_time_sequence<span class="token punctuation">;</span></code></pre><h3 id="6-3-LCD控制器结构体"><a href="#6-3-LCD控制器结构体" class="headerlink" title="6.3 LCD控制器结构体"></a>6.3 LCD控制器结构体</h3><p>包含初始化、使能、禁止函数</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 抽象LCD控制器结构体 * 向上：接收不同的LCD参数 * 向下：使用这些参数设置对应的LCD Controller*/</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> lcd_controller<span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>init<span class="token punctuation">)</span><span class="token punctuation">(</span>p_lcd_params plcdparams<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//初始化</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>enable<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//使</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>disable<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//禁止 </span><span class="token punctuation">}</span>lcd_controller<span class="token punctuation">,</span><span class="token operator">*</span>p_lcd_controller<span class="token punctuation">;</span></code></pre><h2 id="8-LCD控制器初始化"><a href="#8-LCD控制器初始化" class="headerlink" title="8.LCD控制器初始化"></a>8.LCD控制器初始化</h2><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_timing_conditions.png" alt="LCD时序时间表"></p><h3 id="8-1-LCDCON1"><a href="#8-1-LCDCON1" class="headerlink" title="8.1 LCDCON1"></a>8.1 LCDCON1</h3><pre class=" language-c"><code class="language-c">    <span class="token comment" spellcheck="true">/* LCDCON1[17:8] : CLKVAL, vclk = HCLK/[(CLKVAL+1)*2]      *                              = 100M/[(CLKVAL+1)*2]     *                           CLKVAL = 100/vclk/2 - 1 , vclk      * [6:5]：0b11，TFT LCD      * [4:1]：bpp mode      * [0]  ：LCD video output and the logic enable(1)/disable(0)    */</span>    <span class="token keyword">int</span> clkval  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token number">100</span><span class="token operator">/</span>plcdparams<span class="token operator">-></span>time_seq<span class="token punctuation">.</span>vclk<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> bppmode <span class="token operator">=</span> <span class="token punctuation">(</span>plcdparams <span class="token operator">==</span>  <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0x0B</span> <span class="token punctuation">:</span>\ <span class="token comment" spellcheck="true">//8bpp</span>                  <span class="token punctuation">(</span>plcdparams <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0x0C</span> <span class="token punctuation">:</span>\ <span class="token comment" spellcheck="true">//16bpp</span>                  <span class="token number">0x0D</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//24bpp </span>    LCDCON1 <span class="token operator">=</span> <span class="token punctuation">(</span>clkval <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>bppmode <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdcon1.png" alt=""></p><h2 id="7-初始化LCD引脚"><a href="#7-初始化LCD引脚" class="headerlink" title="7.初始化LCD引脚"></a>7.初始化LCD引脚</h2><ul><li>初始LCD专用引脚，配置其模式：<code>LCD Data</code> 与 <code>LCD Control</code></li></ul><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 初始化LCD引脚 */</span><span class="token keyword">void</span> <span class="token function">jz2440_pin_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/* 初始化 背光引脚： GPB0 */</span>    GPBCON <span class="token operator">&amp;</span><span class="token operator">=</span> <span class="token operator">~</span><span class="token number">0x03</span><span class="token punctuation">;</span>    GPBCON <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//输出模式</span>    <span class="token comment" spellcheck="true">/* 初始化LCD专用引脚  */</span>    GPCCON <span class="token operator">=</span> <span class="token number">0xAAAAAAAA</span><span class="token punctuation">;</span>    GPDCON <span class="token operator">=</span> <span class="token number">0xAAAAAAAA</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 电源引脚 LCD_PWRDN */</span>    GPGCON <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><blockquote><p>为了方便GPC、GPD两组，都设置为LCD专用引脚为 0xAAAAAAAA</p></blockquote><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_mode_pins.png" alt=""><br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/gpdcon1.png" alt=""><br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/gpccon1.png" alt=""><br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_pwren_pin.png" alt=""></p><hr><ul><li>由下图S3C2440 LCD控制器时序可得，在设置寄存器时需要在时间参数上-1<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/s3c2440_lcd_timing.png" alt=""><h3 id="8-2-LCDCON2"><a href="#8-2-LCDCON2" class="headerlink" title="8.2 LCDCON2"></a>8.2 LCDCON2</h3><pre class=" language-c"><code class="language-c">  <span class="token comment" spellcheck="true">/*  垂直   *  [31:24] ：VBPD    = Tvb - 1   *  [23:14] ：LINEVAL = line - 1  行数值   *  [13:6]  ：VFPD    = Tvf - 1    *  [5:0]    ：VSPW       = Tvp -1   */</span>  LCDCON2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>time_seq<span class="token punctuation">.</span>tvb <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span> \            <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>yres <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">14</span><span class="token punctuation">)</span>         <span class="token operator">|</span> \            <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>time_seq<span class="token punctuation">.</span>tvf <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token punctuation">)</span> <span class="token operator">|</span> \              <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>time_seq<span class="token punctuation">.</span>tvp <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdcon2_2.png" alt=""></p><h3 id="8-3-LCDCON3"><a href="#8-3-LCDCON3" class="headerlink" title="8.3 LCDCON3"></a>8.3 LCDCON3</h3><pre class=" language-c"><code class="language-c">    <span class="token comment" spellcheck="true">/*  水平                 *  [31:19] ：HBPD    = Thb - 1     *  [18:8]  ：HOZVAL  = 列 - 1  横向像素点     *  [7:0]   ：HFPD    = Thf - 1      */</span>    LCDCON3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>time_seq<span class="token punctuation">.</span>thb <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token operator">|</span> \              <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>xres <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span>             <span class="token operator">|</span> \              <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>time_seq<span class="token punctuation">.</span>thf <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdcon3.png" alt=""></p><h3 id="8-4-LCDCON4"><a href="#8-4-LCDCON4" class="headerlink" title="8.4 LCDCON4"></a>8.4 LCDCON4</h3><pre class=" language-c"><code class="language-c">    <span class="token comment" spellcheck="true">/*  [23:14] ：HSPW = thp - 1  行脉冲宽度     */</span>    LCDCON4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>time_seq<span class="token punctuation">.</span>thp <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdcon4.png" alt=""></p><h3 id="8-5-LCDCON5"><a href="#8-5-LCDCON5" class="headerlink" title="8.5 LCDCON5"></a>8.5 LCDCON5</h3><pre class=" language-c"><code class="language-c">    <span class="token comment" spellcheck="true">/* 用来设置引脚极性, 设置16bpp数据格式, 设置内存中象素存放的格式     * [12] : BPP24BL,This bit determines the order of 24 bpp video memory.     * [11] : FRM565, 1-565     * [10] : INVVCLK, 0 = The video data is fetched at VCLK falling edge     * [9]  : HSYNC是否反转     * [8]  : VSYNC是否反转     * [7]  : INVVD, rgb是否反转     * [6]  : INVVDEN     * [5]  : INVPWREN     * [4]  : INVLEND     * [3]  : PWREN, LCD_PWREN output signal enable/disable     * [2]  : ENLEND       * [1]  : BSWP     * [0]  : HWSWP     */</span>    pixelformat <span class="token operator">=</span> plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>bpp <span class="token operator">==</span> <span class="token number">24</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> \<span class="token operator">/</span><span class="token operator">/</span>24bpp                  plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>bpp <span class="token operator">==</span> <span class="token number">16</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> \ <span class="token comment" spellcheck="true">//16bpp</span>                  <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//8ppp</span>    LCDCON5 <span class="token operator">=</span> <span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>vclk<span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">|</span>\              <span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>hsync<span class="token operator">&lt;&lt;</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">|</span>\              <span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>vsync<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span>\              <span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>rgb<span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span>   <span class="token operator">|</span>\              <span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>de<span class="token operator">&lt;&lt;</span><span class="token number">6</span><span class="token punctuation">)</span>    <span class="token operator">|</span>\              <span class="token punctuation">(</span>plcdparams<span class="token operator">-></span>pins_pol<span class="token punctuation">.</span>pwren<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span>\              <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">|</span> pixelformat<span class="token punctuation">;</span></code></pre><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdcon5_1.png" alt=""><br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdcon5_2.png" alt=""></p><h3 id="8-6-LCDSADDR"><a href="#8-6-LCDSADDR" class="headerlink" title="8.6 LCDSADDR"></a>8.6 LCDSADDR</h3><ul><li>由下图可知：是将fb_base的[30:1]直接写入LCDSADDR1寄存器</li></ul><blockquote><p>起始地址<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdsaddr1.png" alt=""></p></blockquote><blockquote><p>结束地址 = 起始地址 + x * y * bpp/8<br>即为：起始地址+一帧所占空间大小<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdsaddr2.png" alt=""></p></blockquote><h2 id="9-构造LCD参数结构体"><a href="#9-构造LCD参数结构体" class="headerlink" title="9.构造LCD参数结构体"></a>9.构造LCD参数结构体</h2><blockquote><p>对于该款4.3寸LCD而言的参数设置</p></blockquote><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 该款4.3寸 LCD参数结构体 */</span>lcd_params lcd_4_3_params<span class="token punctuation">{</span>     <span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"lcd4.3"</span><span class="token punctuation">,</span>    <span class="token punctuation">.</span>pins_pol <span class="token operator">=</span> <span class="token punctuation">{</span>        vclk  <span class="token operator">=</span> NORMAL<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/* normal：下降沿获取数据 */</span>        hsync <span class="token operator">=</span> INVERT<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* normal：高脉冲 */</span>        vsync <span class="token operator">=</span> INVERT<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* normal：高脉冲 */</span>        rgb   <span class="token operator">=</span> NORMAL<span class="token punctuation">,</span>   <span class="token comment" spellcheck="true">/* normal：高电平表示1 */</span>        de    <span class="token operator">=</span> NORMAL<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">/* normal：高电平使能 data enable */</span>        pwren <span class="token operator">=</span> NORMAL<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* normal：高电平使能power enable */</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">.</span>time_seq <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/* 垂直方向 */</span>        tvp <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* Vsync脉冲宽度 */</span>        tvb <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* 上边黑框 Vertical Back porch */</span>        tvf <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* 下边黑框 Vertical Front porch */</span>        <span class="token comment" spellcheck="true">/* 水平方向 */</span>        thp <span class="token operator">=</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* Hsync脉冲宽度 */</span>        thb <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* 左边黑框 Horizontal Back porch*/</span>        thf <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* 右边黑框 Horizontal Front porch */</span>        vlck <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">/* MHz */</span>    <span class="token punctuation">}</span><span class="token punctuation">.</span>    <span class="token punctuation">.</span>xres <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">,</span>    <span class="token punctuation">.</span>yres <span class="token operator">=</span> <span class="token number">272</span><span class="token punctuation">,</span>    <span class="token punctuation">.</span>bpp  <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true">/* 16bit */</span>    <span class="token punctuation">.</span>fb_base<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/lcd_timing_params.png" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> S3C2440 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LCD </tag>
            
            <tag> ARM9 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>...</title>
      <link href="/2019/12/31/my-first-love/"/>
      <url>/2019/12/31/my-first-love/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="bfdfca0ed195a38ddbe14ffda9aea6661537850e8639c627255ec5d79fcb75dc">924c98d0d902dc274aec90ffafba4ad8942175be31d173ea6bace64fe2d9c1ea2c1d6d125691b1ebf36e5884daedaaaf0a9cf766e02140329b5a8d403e1b66f6d0ed3922bbb2c898620138c080968ce581ec8efc42f15e6348b6a0797fe6d0e4dc2f96d309f9c2c63260e10616035350568aef989116aad608e5bddb6b2f71ca8fe7e98ccda88aa6a6bda65e2263b907c99148cb6efd2b6e1a730739b0a04bd32a3285602f0c50614108dac2745d15db89e1cae70d2707fadbb2a0500d048c77cb827a82beb89d2cb0bc6ff54dc750ba0dde220eeb69e8a8cf3a54b1dacae05ac765e0bb5a9c7da3e6a3a9a31a515efc12880cfa83983e399c3487d5d7674ec8a09a0f59c7843c7c6e2b6d3ab0ad1a35536a674940b2583f8273ff818182adb40aebad956e4405c55b20f265a8c02111558ef82913ff5f9b98b9d9e40632bf17b27978a06a9636959c691c28f35cc0737e6b3579b8a67fa4b6756f769663a8696b03af10d609c2d09275ec596159a590fab395d3146d0d3be7e2711f547e26ce3da197d8f32b216d122a3b98f5953379f03c99ffecda647b5e5f818f418338552f0e3598d2a374835f0799857535b7b453f835ed193ad210525315ae7beeb64009fc9f9248a1b08fabed100b442bca0501d831f26eda4c36348aa533cc11cde213938d218b51bb37f81f4295b942a57556e3f0a549cd77dceb224158d10302c982f9ab071079ed34f3d528f7ca486e4c5b19ba88b77daa07b4c299161293956ee7e1ba7b0303a30802b549c05b510380cfd19210da704de6aa284d365aa7438c6e5663c1b231604cac8326f2bbda6f7663f23a75ae12611354bdccb87be1bea79b6f74d79521154c7a0daa485ba71a1b0ac4e13bcba76156d7f713a9b921775a16e52e041f18560975ddcfbd608b24882902aaf0c4e1a7d3f6f61d8683a4df8b7ed9004085325f5c651507ea279fad7ea2e1e9476cf5b6b542c56e73536fa77b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请输入密码访问</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nand Flash编程</title>
      <link href="/2019/12/27/s3c2440-nand/"/>
      <url>/2019/12/27/s3c2440-nand/</url>
      
        <content type="html"><![CDATA[<h2 id="1-读芯片ID"><a href="#1-读芯片ID" class="headerlink" title="1.读芯片ID"></a>1.读芯片ID</h2><h3 id="1-1-读芯片ID时序"><a href="#1-1-读芯片ID时序" class="headerlink" title="1.1 读芯片ID时序"></a>1.1 读芯片ID时序</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_timing.png" alt=""></p><p> 简化为4个步骤：</p><ul><li><p>1.使能片选</p></li><li><p>2.写命令0x90</p></li><li><p>3.写地址0x00</p></li><li><p>4.读ID信息</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 识别NAND FLASH */</span><span class="token keyword">void</span> <span class="token function">scan_nand_flash</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//保存读取ID信息的数组</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> id_info<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token function">nand_enable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//使能CS</span> <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">nand_write_addr</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     id_info<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">nand_read_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token function">nand_disable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//禁止CS</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Maker  Code: 0x%x\r\n"</span><span class="token punctuation">,</span>id_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Device Code: 0x%x\r\n"</span><span class="token punctuation">,</span>id_info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"3rd   cycle: 0x%x\n\r"</span><span class="token punctuation">,</span>id_info<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Page   size: %d KB\n\r"</span><span class="token punctuation">,</span><span class="token number">1</span>  <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>id_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//页大小与id_info[3]最低2位有关</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Block  size: %d KB\n\r"</span><span class="token punctuation">,</span><span class="token number">64</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>id_info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//块大小与id_info[3]第4、5位有关</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"5th   cycle: 0x%x\n\r"</span><span class="token punctuation">,</span>id_info<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="1-2-由ID数据获得芯片参数"><a href="#1-2-由ID数据获得芯片参数" class="headerlink" title="1.2 由ID数据获得芯片参数"></a>1.2 由ID数据获得芯片参数</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_scan_test.png" alt=""></p></li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_chip_params.png" alt=""></p><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_scan_test2.png" alt=""></p><ul><li>ID信息的第4字节为<code>0x95</code></li><li>页大小与id_info[3]最低2位有关，可得<strong>页大小</strong>为：<code>2KB</code></li><li>块大小与id_info[3]第4、5位有关，可得<strong>块大小</strong>为：<code>128KB</code></li></ul><blockquote><p>注意：如果此时烧写到Nand Flash，并从Nand Flash启动程序是不会成功的，因为这个bin文件大小已经超过了4K，且现在还没有实现nand flash的读函数。</p></blockquote><h2 id="2-读数据"><a href="#2-读数据" class="headerlink" title="2.读数据"></a>2.读数据</h2><blockquote><p>目标：实现从NAND FLASH中启动，重定位所有数据至SDRAM，并实现读取芯片ID数据</p></blockquote><h3 id="2-1-NAND内部结构分析"><a href="#2-1-NAND内部结构分析" class="headerlink" title="2.1 NAND内部结构分析"></a>2.1 NAND内部结构分析</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_struct.png" alt=""></p><ul><li>OOB：out of bank（在bank之外）<br>由上图可得：</li><li>1Page = 2KB + 64B</li><li>1Block = 64 * Pages = 128KB + 4KB</li><li>1Device = 2048 * Blocks = 256MB + 8MB</li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_data_store.png" alt=""></p><ul><li>OOB区的作用：因为nand的缺点是会发生<code>“位反转”</code>，为了解决这个问题，nand中的OOB区，<strong>用于校验数据区的数据是否发生错误</strong>，当有错误时，可以恢复数据。（其本身不存储数据）</li><li>因为OOB中并不存放数据，只是用于校验数据区是否发生错误，因此当CPU读取Nand Flash<strong>第2048</strong>个数据，该数据为 <code>Page1中的第0个byte</code></li></ul><h3 id="2-2-地址序列与时序"><a href="#2-2-地址序列与时序" class="headerlink" title="2.2 地址序列与时序"></a>2.2 地址序列与时序</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_addr.png" alt=""></p><ul><li>由地址序列可以看出：发出地址信号共需5个周期，前2个周期发出列地址（Column Address），后3个周期发出行地址（Row Address）</li><li>地址线序列有一些位是没有用到的，其目的也是以后兼容更大芯片的nand falsh<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_read_timing.png" alt=""></li></ul><blockquote><p>Nand Flash内部结构展开大致如下：<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_struct2.png" alt=""></p></blockquote><h3 id="2-3-读数据流程"><a href="#2-3-读数据流程" class="headerlink" title="2.3 读数据流程"></a>2.3 读数据流程</h3><ul><li>1.发出片选信号</li><li>2.发出0x00命令</li><li>3.<strong>发送5个周期的地址（两个列地址，三个行地址（page））</strong></li><li>4.再发送0x30命令</li><li>5.等待就绪</li><li>6.读数据</li><li>7.禁止片选</li></ul><h3 id="2-4-转换所读地址的列与页"><a href="#2-4-转换所读地址的列与页" class="headerlink" title="2.4 转换所读地址的列与页"></a>2.4 转换所读地址的列与页</h3><p>将输入的地址addr转换为：</p><ul><li>列地址（Col Address）<ul><li>page是定位到哪一个页，col变量定位的就是在这个页的偏移量（在这个页上的第几列0~2047）</li></ul></li><li>行地址（页）<ul><li>因为读取数据的时候是一次性读出一页，因此当给出地址addr之后，每一页的数据大小是2K，因此我们可以根据地址知道我们读取的数据是哪一个页</li></ul></li></ul><pre class=" language-c"><code class="language-c">    <span class="token keyword">int</span> col  <span class="token operator">=</span> addr <span class="token operator">%</span> <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//列地址  addr &amp;(2048-1); </span>    <span class="token keyword">int</span> page <span class="token operator">=</span> addr <span class="token operator">/</span> <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//行地址（相当于页地址）</span></code></pre><h3 id="2-5-NAND等待就绪"><a href="#2-5-NAND等待就绪" class="headerlink" title="2.5 NAND等待就绪"></a>2.5 NAND等待就绪</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_nfcon.png" alt=""></p><ul><li>当NFSATA[0] = 0时，表示正忙</li><li>当NFSATA[0] = 1时，表示就绪<pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 等待NAND就绪 */</span><span class="token keyword">void</span> <span class="token function">nand_wait_ready</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>NFSTAT <span class="token operator">&amp;</span> <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//当NFSATA[0] = 1时，表示就绪</span><span class="token punctuation">}</span></code></pre></li></ul><h3 id="2-6-读取数据函数"><a href="#2-6-读取数据函数" class="headerlink" title="2.6 读取数据函数"></a>2.6 读取数据函数</h3><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* NAND FLASH读取数据 * param:读取的地址、存放的地址、读取的长度 */</span><span class="token keyword">void</span> <span class="token function">read_nand_data</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> addr<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*page是定位到哪一个页，col变量定位的就是在这个     *页的偏移量（在这个页上的第几列0~2047）     */</span>    <span class="token keyword">int</span> col  <span class="token operator">=</span> addr <span class="token operator">%</span> <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//列地址  addr &amp;(2048-1); </span>    <span class="token comment" spellcheck="true">/* 因为读取数据的时候是一次性读出一页，因此当给出     * 地址addr之后，每一页的数据大小是2K，因此我们可以     * 根据地址知道我们读取的数据是哪一个页     */</span>    <span class="token keyword">int</span> page <span class="token operator">=</span> addr <span class="token operator">/</span> <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//行地址（相当于页地址）</span>    <span class="token function">nand_enable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//1.使能CS</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">//2.发出0x00命令</span>        <span class="token comment" spellcheck="true">/* col addr */</span>        <span class="token function">nand_write_addr</span><span class="token punctuation">(</span>col <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//3.发出地址</span>        <span class="token function">nand_write_addr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>col <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">/* row/page addr */</span>        <span class="token function">nand_write_addr</span><span class="token punctuation">(</span>page <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">nand_write_addr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page <span class="token operator">>></span>  <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">nand_write_addr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//4.发出0x30命令</span>        <span class="token function">nand_wait_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//5.等待就绪</span>        <span class="token comment" spellcheck="true">/* for循环中有2个条件         * 1.当读到页尾，但还是没有读完，说明需要读取下一页         * 2.当已经读取指定字节数，则不再读取         */</span>             <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>col <span class="token operator">&lt;</span> <span class="token number">2048</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> col<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//6.读数据</span>            buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">nand_read_data_byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        page<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//指向下一页</span>    <span class="token punctuation">}</span>    <span class="token function">nand_disable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//7.禁止CS</span><span class="token punctuation">}</span></code></pre><h3 id="2-7-NAND重定位"><a href="#2-7-NAND重定位" class="headerlink" title="2.7 NAND重定位"></a>2.7 NAND重定位</h3><blockquote><p>从Nand Flash启动，此时片内SRAM的地址对应的就是CPU的0地址，如果从Nand Flash启动，2440硬件会把nand Flash前4K的数据复制到片内SRAM,如果Nand Flash上的程序大于4K,那后续数据就会丢失，相当于只重定位了前4K的代码。</p></blockquote><p>如何解决上述问题：</p><ul><li>1.前提：实现了NAND FLASH读取数据函数</li><li>2.代码烧写到NAND FLASH,并从NAND中启动</li><li>3.程序运行到重定位代码的位置判断一下，是从Nand Flash启动还是NOR  Flash启动（通过往0地址写数据，因为Nand是支持读写的，所以读出的结果和写的结果一样，而NOR Flash不能像内存一样读写，因此读写的内容是不一致的）</li><li>4.如果从NOR Flash启动，直接使用简单的重定位代码就行，如果是Nand Flash启动，那就是用Nnad Flash的读函数进行代码的重定位。</li></ul><hr><blockquote><p>首先判断从NorFlash or NandFlash中启动</p></blockquote><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 检查是否从NorFlash中启动 * 方法：写0x12345678到0地址，在读取出来，如果得到0x12345678，表示0地址上的内容被修改，即为片内RAM，则为nand启动 * 原因：原因：nor不能直接写入，写入需要发出一定格式的数据，才能写入 * 返回0为nand启动，返回1为nor启动*/</span><span class="token keyword">int</span> <span class="token function">isBootFromNorFlash</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token operator">*</span>p<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//暂存[0]上的数据</span>    <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">0xdeadc0de</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//dead code任意值</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0xdeadc0de</span> <span class="token operator">==</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/* 写成功，对应nand启动 */</span>        <span class="token operator">*</span>p <span class="token operator">=</span> val<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//恢复原来的值</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><blockquote><p>重定位代码</p></blockquote><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* * 将除bss段的全部数据拷贝到sdram中 * 传递形参，原地址src:_start  目标地址dest:__bss_start  长度len:__bss_start-_star */</span><span class="token keyword">void</span> <span class="token function">copy_to_sdram</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/* 要从lds文件中获取__code_start、__bss_start     * 然后从0地址把数据复制到__code_start     */</span>    <span class="token keyword">extern</span> <span class="token keyword">int</span> __code_start<span class="token punctuation">,</span>__bss_start<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//声明外部变量</span>    <span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>src  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//flash中0地址 </span>    <span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>dest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>__code_start<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//目标地址：sdram中的0x30000000地址</span>    <span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>end  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>__bss_start<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//结束地址：bss的起始地址</span>    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>__bss_start <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>__code_start<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取数据总长度</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isBootFromNorFlash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//如果从Nor中启动</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>dest <span class="token operator">&lt;</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token operator">*</span>dest<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">*</span>src<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//拷贝</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//从Nand中启动,需要先初始化nand，然后重定位代码</span>        <span class="token function">nand_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//从 src 复制到 des ,总共复制len字节，也就是重定位的代码</span>        <span class="token function">read_nand_data</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>src<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>dest<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="2-7-读数据测试"><a href="#2-7-读数据测试" class="headerlink" title="2.7 读数据测试"></a>2.7 读数据测试</h3><blockquote><p>读取0地址后160bytes的数据，如果跟.bin文件前160字节数据相同，则读取成功，否则读取失败</p></blockquote><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 测试函数：读数nand上160bytes数据  */</span><span class="token keyword">void</span> <span class="token function">read_nand_flash</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> addr<span class="token punctuation">,</span>hex_addr<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> c<span class="token punctuation">,</span>str<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 获得地址 */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"*****Enter the address to read:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    addr <span class="token operator">=</span> <span class="token function">get_uint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">read_nand_data</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取到地址上的数据</span>    p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>data<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//p指向data,用于打印data数据</span>    hex_addr <span class="token operator">=</span> addr<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//起始地址</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Read Data:\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"            00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">/* 长度固定为160 bytes */</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0x%08x  "</span><span class="token punctuation">,</span>hex_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//每行打印16个16进制数</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            c <span class="token operator">=</span> <span class="token operator">*</span>p<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//读取16个</span>            str<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//保存字符</span>            <span class="token comment" spellcheck="true">//先打印数值</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%02x "</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" | "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//后打印字符</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0x20</span> <span class="token operator">||</span> str<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//不可视字符,打印‘.’</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span>str<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        hex_addr<span class="token operator">+</span><span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//换行+16</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_bin_data.png" alt=""></p><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_read_test2.png" alt=""><br>由上测试可知读取成功</p><h2 id="3-擦除"><a href="#3-擦除" class="headerlink" title="3.擦除"></a>3.擦除</h2><h3 id="3-1-擦除时序"><a href="#3-1-擦除时序" class="headerlink" title="3.1 擦除时序"></a>3.1 擦除时序</h3><ul><li>1.发出片选信号</li><li>2.发出0x60命令</li><li>3.<strong>发送3个行地址（page）</strong></li><li>4.再发送0xD0命令</li><li>5.等待就绪（等待擦除完成）</li><li>6.禁止片选</li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_erase_timing.png" alt=""></p><h3 id="3-2-地址和参数合法性"><a href="#3-2-地址和参数合法性" class="headerlink" title="3.2 地址和参数合法性"></a>3.2 地址和参数合法性</h3><ul><li>由于按块来擦除（128KB），因此地址和参数都必须是128K的倍数</li><li><pre class=" language-c"><code class="language-c">  <span class="token comment" spellcheck="true">/* 检查参数合法性 */</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>addr <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x1FFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//128K</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Err addr! Please enter an integral multiple of 128K\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x1FFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//128K</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Err len! Please enter an integral multiple of 128K\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre></li></ul><h3 id="3-3-擦除函数"><a href="#3-3-擦除函数" class="headerlink" title="3.3 擦除函数"></a>3.3 擦除函数</h3><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* NAND FLASH擦除数据 * param:擦除的起始地址、擦除的长度(byte) * ret:失败-1，成功0*/</span><span class="token keyword">int</span> <span class="token function">erase_nand_data</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> addr<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> page <span class="token operator">=</span> addr <span class="token operator">/</span> <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//行地址</span>    <span class="token comment" spellcheck="true">/* 检查参数合法性 */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>addr <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x1FFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//128K</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Err addr! Please enter an integral multiple of 128K\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x1FFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//128K</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Err len! Please enter an integral multiple of 128K\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/* 1.使能CS */</span>    <span class="token function">nand_enable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        page <span class="token operator">=</span> addr <span class="token operator">/</span> <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//行地址</span>        <span class="token comment" spellcheck="true">/* 2.发出0x60命令 */</span>        <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">/* 3.发出地址row/page addr */</span>        <span class="token function">nand_page</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">/* 4.发出0xD0命令 */</span>        <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0xD0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">/* 5.等待就绪(等待擦除完成) */</span>        <span class="token function">nand_wait_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            len <span class="token operator">-</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//长度减去一个block</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        addr <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//指向下一块</span>    <span class="token punctuation">}</span>     <span class="token comment" spellcheck="true">/* 6.禁止CS */</span>    <span class="token function">nand_disable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="3-4-擦除数据测试"><a href="#3-4-擦除数据测试" class="headerlink" title="3.4 擦除数据测试"></a>3.4 擦除数据测试</h3><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 擦除测试函数：固定擦除一个1block = 128K*/</span><span class="token keyword">void</span> <span class="token function">erase_nand_flash</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> addr<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> whichblock<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 获得第几个Block */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the address of sector to erase: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    addr <span class="token operator">=</span> <span class="token function">get_uint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    whichblock <span class="token operator">=</span> addr <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** block number : [ %d ]\r\n"</span><span class="token punctuation">,</span>whichblock<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 提示擦除数据的范围 */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** Erase range : 0x%08x - 0x%08x\n\r"</span><span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token punctuation">(</span>addr<span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** erase ...\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">erase_nand_data</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token number">128</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//如果擦除成功</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** Erase finished!\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">else</span><span class="token punctuation">{</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** Erase fail!\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_erase_test.png" alt=""></p><h2 id="4-写数据"><a href="#4-写数据" class="headerlink" title="4.写数据"></a>4.写数据</h2><h3 id="4-1-写数据时序"><a href="#4-1-写数据时序" class="headerlink" title="4.1 写数据时序"></a>4.1 写数据时序</h3><ul><li>1.发出片选信号</li><li>2.发出0x80命令</li><li>3.<strong>发送5个周期的地址（两个列地址，三个行地址（page））</strong></li><li>4.写入数据</li><li>5.再发送0x10命令</li><li>6.等待就绪（等待擦除完成）</li><li>7.禁止片选<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_wriet_timing.png" alt=""></li></ul><h3 id="4-2-写数据函数"><a href="#4-2-写数据函数" class="headerlink" title="4.2 写数据函数"></a>4.2 写数据函数</h3><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* NAND FLASH写入数据 * param:写入的地址、数据指针、写入的长度 */</span><span class="token keyword">void</span> <span class="token function">write_nand_data</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> addr<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> page <span class="token operator">=</span> addr <span class="token operator">/</span> <span class="token number">2048</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> col <span class="token operator">=</span> addr <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">2048</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 1.使能CS */</span>    <span class="token function">nand_enable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/* 2.发出0x80命令 */</span>        <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* 3.发出地址 */</span>        <span class="token function">nand_col</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">nand_page</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* 4.写入数据*/</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>col <span class="token operator">&lt;</span> <span class="token number">2048</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">nand_write_data_byte</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">/* 5.发出0x10命令 */</span>        <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* 6.等待就绪(等待写入完成) */</span>        <span class="token function">nand_wait_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            page<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/* 7.禁止CS */</span>    <span class="token function">nand_disable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="4-3-写数据测试"><a href="#4-3-写数据测试" class="headerlink" title="4.3 写数据测试"></a>4.3 写数据测试</h3><blockquote><p>此处注意：一般在烧写数据之前需要对数据进行擦除操作，除非原本的数据全f，否则都需要进行擦除，不然写入的数据会有问题。</p></blockquote><pre class=" language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">write_nand_flash</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> addr<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> len<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 获得第几个Block */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** Enter addr to write: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    addr <span class="token operator">=</span> <span class="token function">get_uint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** Enter the string to write: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">gets</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>    len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** write range : 0x%08x - 0x%08x\r\n"</span><span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token punctuation">(</span>addr <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** writing ...\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write_nand_data</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span>str<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//strlen不包括结束符'\0'，因此需要+1</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"***** writing finished\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><ul><li>在<code>0x100000</code>地址写入“hello,world!”<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_write_test.png" alt=""></li><li>读取数据<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_read_test3.png" alt=""></li></ul><h2 id="5-判断是否为坏块"><a href="#5-判断是否为坏块" class="headerlink" title="5.判断是否为坏块"></a>5.判断是否为坏块</h2><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/nand_data_store.png" alt=""></p><blockquote><p>通过读取OOB区的第0个字节（即第<code>2048</code>个字节）来判断，如果不是0xFF，为坏块，否则不是</p></blockquote><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* 判断是否为坏块 * ret:返回1为坏块，返回0不是 */</span><span class="token keyword">int</span> <span class="token function">isNandBadBlock</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> addr<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> col <span class="token operator">=</span> <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//读取OOB区第0个字节</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> page <span class="token operator">=</span> addr <span class="token operator">/</span> <span class="token number">2048</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 1. 选中 */</span>    <span class="token function">nand_enable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 2. 发出读命令00h */</span>    <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 3. 发出地址(分5步发出) */</span>    <span class="token function">nand_col</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">nand_page</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 4. 发出读命令30h */</span>    <span class="token function">nand_write_cmd</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 5. 判断状态,等待就绪 */</span>    <span class="token function">nand_wait_ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 6. 读数据 */</span>    val <span class="token operator">=</span> <span class="token function">nand_read_data_byte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/* 7. 取消选中 */</span>        <span class="token function">nand_disable_cs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">!=</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 坏块 */</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="6-ECC"><a href="#6-ECC" class="headerlink" title="6.ECC"></a>6.ECC</h2><ul><li>ECC（Error Checking and Correction），是一种用于Nand的差错检测和修正算法。</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> S3C2440 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ARM9 </tag>
            
            <tag> Nand </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实用的网站及工具</title>
      <link href="/2019/12/25/websites/"/>
      <url>/2019/12/25/websites/</url>
      
        <content type="html"><![CDATA[<p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/web_logo.png" alt=""></p><h2 id="学习类"><a href="#学习类" class="headerlink" title="学习类"></a>学习类</h2><h3 id="1-LeetCode：算法必备"><a href="#1-LeetCode：算法必备" class="headerlink" title="1. LeetCode：算法必备"></a>1. LeetCode：算法必备</h3><ul><li><p><a href="https://leetcode-cn.com//" target="_blank" rel="noopener">LeetCode</a></p><blockquote><p> 数据结构与算法，熟悉各互联网公司的算法题目</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/leetcode.png" alt=""></p></li></ul><h2 id="图片-图标类"><a href="#图片-图标类" class="headerlink" title="图片/图标类"></a>图片/图标类</h2><h3 id="1-Unsplash：优美免费无版权高清图片"><a href="#1-Unsplash：优美免费无版权高清图片" class="headerlink" title="1. Unsplash：优美免费无版权高清图片"></a>1. Unsplash：优美免费无版权高清图片</h3><ul><li><p><a href="https://unsplash.com/" target="_blank" rel="noopener">Unsplash 官网</a> </p><blockquote><p>优美免费无版权高清图片壁纸设计素材资源网站</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/unsplash.png" alt=""></p></li></ul><h3 id="2-Iconfont：阿里巴巴矢量图标库"><a href="#2-Iconfont：阿里巴巴矢量图标库" class="headerlink" title="2. Iconfont：阿里巴巴矢量图标库"></a>2. Iconfont：阿里巴巴矢量图标库</h3><ul><li><p><a href="https://www.iconfont.cn" target="_blank" rel="noopener">Iconfont 官网</a> </p><blockquote><p>Iconfont-阿里巴巴矢量图标库，国内功能很强大且图标内容很丰富的矢量图标库,提供矢量图标下载、在线存储、格式转换等功能</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/iconfont.png" alt=""></p></li></ul><h2 id="设计类"><a href="#设计类" class="headerlink" title="设计类"></a>设计类</h2><h3 id="1-Process-On：免费在线作图，实时协作"><a href="#1-Process-On：免费在线作图，实时协作" class="headerlink" title="1. Process On：免费在线作图，实时协作"></a>1. Process On：免费在线作图，实时协作</h3><ul><li><p><a href="https://www.processon.com/" target="_blank" rel="noopener">ProcessOn 官网</a></p><blockquote><p>ProcessOn是一个在线作图工具的聚合平台，它可以在线画流程图、思维导图、UI原型图、UML、网络拓扑图、组织结构图等等。</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/processon.png" alt=""></p></li></ul><h3 id="2-3DContentCentral：免费-3D-CAD-模型"><a href="#2-3DContentCentral：免费-3D-CAD-模型" class="headerlink" title="2. 3DContentCentral：免费 3D CAD 模型"></a>2. 3DContentCentral：免费 3D CAD 模型</h3><ul><li><p><a href="https://www.3dcontentcentral.cn/" target="_blank" rel="noopener">3DContentCentral 官网</a></p><blockquote><p>免费 3D CAD 模型、2D 工程图和供应商目录</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/3dcontentcentral.png" alt=""></p></li></ul><h2 id="办公类"><a href="#办公类" class="headerlink" title="办公类"></a>办公类</h2><h3 id="1-Worktile：团队协作，任务分配"><a href="#1-Worktile：团队协作，任务分配" class="headerlink" title="1. Worktile：团队协作，任务分配"></a>1. Worktile：团队协作，任务分配</h3><ul><li><p><a href="https://worktile.com/" target="_blank" rel="noopener">Worktile 官网</a></p><blockquote><p>Worktile 是一站式敏捷研发与DevOps平台，提升研发效能，助力更好更快地发布产品。</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/worktile.png" alt=""></p></li></ul><h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><h3 id="1-ALLDATASHEET：必备的数据手网站"><a href="#1-ALLDATASHEET：必备的数据手网站" class="headerlink" title="1. ALLDATASHEET：必备的数据手网站"></a>1. ALLDATASHEET：必备的数据手网站</h3><ul><li><p><a href="https://www.alldatasheet.com/" target="_blank" rel="noopener">ALLDATASHEET 官网</a></p><blockquote><p>不用注册，而且是免费的，Alldatasheet向所有的人免费提供半导体以及电子产品数据表Alldatasheet 的主要使用群是从事工程师&amp;工程设计管理以及设计&amp;开发等。</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/alldatasheet.png" alt=""></p></li></ul><h3 id="2-Shields：Github徽章"><a href="#2-Shields：Github徽章" class="headerlink" title="2. Shields：Github徽章"></a>2. Shields：Github徽章</h3><ul><li><p><a href="https://shields.io/" target="_blank" rel="noopener">Shields 官网</a></p><blockquote><p>开源项目的质量数据标识</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/shields.png" alt=""></p></li></ul><h3 id="3-CodeIF：变量命名神器"><a href="#3-CodeIF：变量命名神器" class="headerlink" title="3. CodeIF：变量命名神器"></a>3. CodeIF：变量命名神器</h3><ul><li><p><a href="https://unbug.github.io/codelf/" target="_blank" rel="noopener">CodeIF 官网</a></p><blockquote><p>通过搜索GitHub, Bitbucket, GitLab来找到真实的使用变量名</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/codeif.png" alt=""></p><h3 id="4-印象笔记：全平台电子笔记"><a href="#4-印象笔记：全平台电子笔记" class="headerlink" title="4. 印象笔记：全平台电子笔记"></a>4. 印象笔记：全平台电子笔记</h3></li><li><p><a href="https://www.yinxiang.com/" target="_blank" rel="noopener">印象笔记 官网</a></p><blockquote><p>一站式地完成信息的收集备份、永久保存和高效整理。模板、清单、思维导图、印象笔记·剪藏等多种特色功能，全面提升你的日常效率。</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/yinxiang.png" alt=""></p></li></ul><h3 id="5-牛客：求职必备网站"><a href="#5-牛客：求职必备网站" class="headerlink" title="5. 牛客：求职必备网站"></a>5. 牛客：求职必备网站</h3><ul><li><p><a href="https://www.nowcoder.com/" target="_blank" rel="noopener">牛客 官网</a></p><blockquote><p>面经、面试题、求职信息</p></blockquote><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/newcoder.png" alt=""></p></li></ul><h3 id="6-MaHua：在线markdown编辑器"><a href="#6-MaHua：在线markdown编辑器" class="headerlink" title="6.MaHua：在线markdown编辑器"></a>6.MaHua：在线markdown编辑器</h3><ul><li><a href="http://mahua.jser.me/" target="_blank" rel="noopener">MaHua 官网</a></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 效率工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用七牛云+PicGo进行图片管理与上传</title>
      <link href="/2019/12/15/qiniu-picgo-img/"/>
      <url>/2019/12/15/qiniu-picgo-img/</url>
      
        <content type="html"><![CDATA[<h2 id="1-注册七牛云账号"><a href="#1-注册七牛云账号" class="headerlink" title="1.注册七牛云账号"></a>1.注册七牛云账号</h2><ul><li><a href="https://portal.qiniu.com/signup" target="_blank" rel="noopener">点击注册七牛云</a></li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_signup.png" alt="注册七牛云"></p><blockquote><p>需要<strong>实名认证</strong>，认证之后再进行上传图片<br>点击进入“个人中心”-&gt; “个人信息”，进行实名认证，即有10G免费存储空间</p></blockquote><h2 id="2-创建标准存储空间"><a href="#2-创建标准存储空间" class="headerlink" title="2.创建标准存储空间"></a>2.创建标准存储空间</h2><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_controller.png" alt="点击进入控制台"></p><h3 id="2-1-添加对象存储"><a href="#2-1-添加对象存储" class="headerlink" title="2.1 添加对象存储"></a>2.1 添加对象存储</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_store.png" alt="点击对象存储"></p><h3 id="2-2-设置存储空间"><a href="#2-2-设置存储空间" class="headerlink" title="2.2 设置存储空间"></a>2.2 设置存储空间</h3><p>存储空间名称：自行命名<br>存储区域：选与你地域较近的区域<br>访问控制：选“公开空间”，否则外网无法访问<br><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_store_setting.png" alt="存储空间设置"></p><h3 id="2-3-上传图片"><a href="#2-3-上传图片" class="headerlink" title="2.3 上传图片"></a>2.3 上传图片</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_upload.png" alt="上传图片"></p><h3 id="2-4-获取图片外链"><a href="#2-4-获取图片外链" class="headerlink" title="2.4 获取图片外链"></a>2.4 获取图片外链</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_copy_url.png" alt="获取图片外链"></p><h2 id="3-使用PicGo进行管理与上传"><a href="#3-使用PicGo进行管理与上传" class="headerlink" title="3.使用PicGo进行管理与上传"></a>3.使用PicGo进行管理与上传</h2><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/picgo.png" alt="PicGo"></p><ul><li><a href="https://github.com/Molunerfinn/PicGo/releases" target="_blank" rel="noopener">点击下载PicGo</a></li></ul><h3 id="3-1-设置七牛图床"><a href="#3-1-设置七牛图床" class="headerlink" title="3.1 设置七牛图床"></a>3.1 设置七牛图床</h3><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/picgo_qiniu_setting.png" alt="设置七牛图床"></p><ul><li>1.获得AK与SK</li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_ak_sk.png" alt=""></p><ul><li>2.存储空间名要与之前创建的空间名移植</li><li>3.获得访问网址</li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/qiniu_copy_web.png" alt="访问网址"></p><h3 id="3-2-复制外链"><a href="#3-2-复制外链" class="headerlink" title="3.2 复制外链"></a>3.2 复制外链</h3><p>上传完的图片就会在相册中，并且预览、复制链接</p><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/picgo_photos.png" alt=""></p><h3 id="3-3-自定义链接格式"><a href="#3-3-自定义链接格式" class="headerlink" title="3.3 自定义链接格式"></a>3.3 自定义链接格式</h3><ul><li><code>Custom</code>模式可以自定义链接格式</li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/picgo_set_url.png" alt=""></p><p>-用占位符<code>$url</code>来表示ul的位置</p><ul><li>用占位符<code>$fileName</code>来表示文件名的位置</li></ul><p><img src="https://ian-study.oss-cn-shanghai.aliyuncs.com/picgo_set_by_custom.png" alt="自定义链接格式"></p><p>点击复制，就会按照自定义的格式复制链接，eg：</p><pre><code>![在这里描述图片](https://ian-study.oss-cn-shanghai.aliyuncs.com/lcdcon1.png)</code></pre><h3 id="3-4-PicGo插件"><a href="#3-4-PicGo插件" class="headerlink" title="3.4 PicGo插件"></a>3.4 PicGo插件</h3><ul><li><a href="https://github.com/PicGo/Awesome-PicGo" target="_blank" rel="noopener">点击进入PicGo插件合集页面</a></li></ul><hr><ul><li><a href="https://github.com/PicGo/picgo-plugin-autocopy" target="_blank" rel="noopener">PicGo -plugin-autocopy</a>:用于上传后将url自动复制到剪贴板的PicGo插件。【CLI】</li><li><a href="https://github.com/zWingz/picgo-plugin-github-plus" target="_blank" rel="noopener">PicGo -plugin-github-plus</a>: PicGo上传github &amp; gitee同步功能。【GUI】</li><li><a href="https://github.com/picgo/picgo-plugin-pico-migrater" target="_blank" rel="noopener">PicGo -plugin- pico -migrater</a> :一个PicGo插件，用于将markdown文件中的图片从一个picBed迁移到另一个picBed。【CLI&amp;GUI】</li><li><a href="https://github.com/yuki-xin/picgo-plugin-web-uploader" target="_blank" rel="noopener">PicGo -plugin-web-uploader</a>: PicGo上传自定义web api。【GUI】</li><li><a href="https://github.com/chengww5217/picgo-plugin-qingstor-uploader" target="_blank" rel="noopener">PicGo -plugin-qingstor-uploader</a>: PicGo插件与添加的青石图片托管。【GUI】</li><li><a href="https://github.com/upupming/picgo-plugin-vscode-migrator" target="_blank" rel="noopener">PicGo -plugin-vscode-migrator</a>: PicGo从<a href="https://github.com/Spades-S/vs-picgo/" target="_blank" rel="noopener">‘ vs-picgo ‘</a>导入图像的插件【GUI】</li><li><a href="https://github.com/gclove/picgo-plugin-super-prefix#readme" target="_blank" rel="noopener">PicGo -plugin-super-prefix</a>: PicGo自定义图像文件名和前缀的插件【CLI&amp;GUI】</li><li><a href="https://github.com/xlzy520/picgo-plugin-smms-user.git" target="_blank" rel="noopener">PicGo -plugin-smms-user</a>:针对SM注册用户的PicGo插件。MS【GUI】</li><li><a href="https://github.com/bugwz/picgo-plugin-gitlab" target="_blank" rel="noopener">PicGo -plugin- GitLab</a>: PicGo GitLab上传器【CLI&amp;GUI】</li><li><a href="https://www.npmjs.com/package/picgo-plugin-bilibili" target="_blank" rel="noopener">PicGo -plugin-bilibili</a>: PicGo上传bilibli【CLI&amp;GUI】- <a href="https://github.com/zhanghuid/picgo-plugin-gitee" target="_blank" rel="noopener">PicGo -plugin-gitee</a>: PicGo gitee上传器【CLI&amp;GUI】</li><li><a href="https://github.com/lizhuangs/picgo-plugin-gitee-uploader#readme" target="_blank" rel="noopener">PicGo -plugin-gitee-uploader</a></li><li><a href="https://github.com/jiajiajia343434/picgo-plugin-nextcloud-uploader" target="_blank" rel="noopener">PicGo -plugin- NextCloud - Uploader</a>: PicGo - Uploader for NextCloud【CLI&amp;GUI】</li><li><a href="https://github.com/Dec-F/picgo-plugin-watermark" target="_blank" rel="noopener">PicGo -plugin-watermark</a>: PicGo的水印插件【CLI&amp;GUI】【v2.2.0+】</li><li><a href="https://github.com/PicGo/picgo-plugin-quick-capture" target="_blank" rel="noopener">PicGo -plugin-quick-capture</a>: PicGo【CLI&amp;GUI】【v2.2.0+】快速截图及上传插件</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 效率工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DJI大疆嵌入式秋招记录</title>
      <link href="/2019/10/01/dji-offer/"/>
      <url>/2019/10/01/dji-offer/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="35523e420d5aeb8ee4630d76a0b15c9bf1cf695e8b5a285225524087fe6497e9">e898b40d052ded995b23c4672b59d678557dd647bb9bb4126e5d5a880e3d861335f988bd2947d77622dfe0c738e6e74cccd5f61b8e4b258e3fbab390b4ab189978fc7bcd2491060344a271895c9839d64325cbc3c7d555c8715567c60d6706bd156b5db6b535ebbd04aecbaa86f947f40aa5a48acb3a00b46c09a32a8f3e5f77a338eb8ed344f4f0150b83ed8fc848be0a58d185e277ac37e48973f7fab4c89eca6f98cadd4bbe5568aed2c81f8f2ca071d3766ffaf3a9c67f745b89a34b79dff43cb6ba074ee328d0c9418c81302b95072dcb46800385170b7e0f4513012cc80fc18109164274e4173d8118de3c3f8337fbf858fb5583c7057e86cb320abe5df21560d3d379bbfc6b298d4c3de549536fb4a8503c731c167f14f102b0e74f492ad2accb064944bc2be03a7b70c5a082c654fddcdb61390a22b8382e299163ee4574b2d9a46d2ec61575e603353ca8ff0b025564e5e4673e143244546d8ac50cbbf866af1c7b8966974ded1cfed77660d1f8130701b854e22b99439ed4d75bdecca8fc6186738cbc7d424d2c273028eea9c3fd286d7b39c93ae2e404eb77631c60a3dfcc2c5927086b5b4bad68a5d61aa1f256b092ec36b0cdb7a914cddb935d03ca79e00a3114cd6528cd2c461a3acc31abf9e171c1f8417350c882d09dfb8881ae3f044894f8133014c4a83e216245159258d184df0022f97448206315c676badac76be41568a3d40e3733dd01a7351372a1d9b718871e5de6fdbdbdfe453b16be6410edacc625f8f24f4e6cd30605a7c99a9bce80f2ace5a60dba002abac7a0fccff5a7800ea0dad2c5f5f04429f1fa2cfc4b0fe611ffde0920ea6a26c1cc251a64cf25d3e672b3a8e03424db601cd66faba9c8530648f103e8bbcafd7ca4556d4bcd5883cca32e09c2e01e5de3dca0b2b47c71ce2f804423127eb7d054860daffce7a684fa7e213bdae8085b34b507a5b2282b6353eed65c8ecd20c8b0f3598147afd17353c2c626262b0e4caa843ffa59d7f2ae25567c7be0302fda8955649c5cc580c4bc163267d3c5cea289048d7c27b1185a69ca6cccb7b232795b3956c9f6b9aabe248ba868302eb4d9478c5fbd5a9ee73f7b113cf5a964d6efb8a9ec039770f36ca2d75fad59b5e8b04f39040ecda9e41e9c0c2aa72ca6c9245c220e636be5c8d82595dcdd55d4cf8cad88b0c1b49b89bd56476f6b887ba183e3e17bd1ff3978060ff86b4181baf9d374facc721c754d61bd0e8b68f28d7f35c4112a3cf083e857b3f9818ad15e5f8cda061a0c504b649daeefb8cc2bb85d560b23f04915721381b4adaf1c0194625c4ffaaf3d1e6f58a699140d4f4046a5bedc19b51e4c9baef31fc6c074c820c61226463a7d7766d6a77c95080b85d36742029db1baf6be9e340bd3f1a683142d4ea689ab0be0978f91c97fbf0b3ca0f05460259dfcb70b7d34dc8a7a1984ef2e34e86d7e773b65a93abcbffa045e8afd3933983ed75c047b782a892e22f6f4cbd10be3855887c823e545bc037f69961c860501b2b56fe4b019dc918c74cce5e12c67fa7abe22c4430b9dad623c98f41fd8bbde5f5163a9e3fab96a24ffcdffa4b07ac0b60ce490669d8fd70b1ffb262b6916ca4389e30854e9f5427f7783a9aa50f17ba3ce3ce72ab71c347cd570e1f33c5a925d33a24b879e865475097ae2f3dbb477bfa0683f8b0f7719d53f6aef38e536cc4a034a47187a24e6fe5f75fb8d312891e63d01a1ec5b57a566775add240507e5aa7c94aeab8df855780a4eb2081d8fbf99969b32187659aad56b1fe92206ec635b5984a58170002101d3c1c9d8c0b39939c347d220ce9d8a41e0537b7b08a38f32259f2d12f9c746d9e642459519018aa2ff324300a554f35e0e176eaab587096fffe7031a2db7bf08f0236171ba2d218c2f073c3b645248fc4909244fd4705e687241dd630a22f8f626f2e2d669164fe44214ab58dc67ef509451307eb0fb3dd9de6b0f65b4dfcedf7c0a8553ae97c9fb4da305902f39a6a522c56b83bc4724783613e721a9a086ae4af20195c411900850cb193f487e9e8ec3f7a95dec91e58182865701a7de1649f0bc56e7f6ff940e3e9551e111b291e56f7dfa2bca0c7c902b1d8546806ba8e1f1b26ea6d6de8e6ada4b7ab018cd3ce215eb65ece7608bc36ba3789b4ac8282e8789343602eea1821e4dbf932e4d6798b372dbd26949b01aba7054ca8a5f87072deae55f34a3fd4f47018a42c6be972fa14e2050b34d5a85b95b1cfecd0ddad57376241f1be1afd274c26f139448f0204c978fc56187ce6fb87f42dd67fd873deaaae55066357c346d2c9f2d0c2227e32c27d2dec34f84450de85a83fe6f4d399ab0b21ee10fb2f51ac3c4b412e96fdcb1f1a76e1d42ea95a880d839960e5079452bbe2ae5b57afa1f7fb4209df678daf1e1ed4fc56a7f655525acc25a0e4bf94db29777e2ad0c184626dee732217e4720bb2002313e52d5383c67ba52ac8e291dee5f65ceb0096152f5da21aaa01df3502eddd0bbe675d1abd90df3b457239ac5171ef34e9332d7124c9b3ea4e8719e6a37f0601ba6beea6bc4d95f5fc8fe2a8d810c99768a39dc8baca7a05e6971c142c98815452ad170508d328d6eaa193b13c4abb99a914149b203e8d5f607a53cf904b685354d17a89b4d1d0bf3ecb12bb46e1ee9c5c27bdfc6715069063d803880dfd1cbee2148aa94e2c7edf9fc6e7727b188c3e3377e09efa241837a544e7adae57958a7ea1500dc51ce140521d3299368b0c9202b7072edbfabdb5c84fba0a83dbb0817809fb366af086b126325868c8092413d1258b253598c81ea8006489a259546d2b3ab3f855fdf7cad8f01e5d310b7fd679d34905e4e0c6d2488fa23f496000f591abcf559274454e83e7aca0f63d8f228dfb5a3ca06929578cc55ed140389191dc994642b3c2f75b1e33b1021f88320804ab76e067679ee4cd521255c256d703b0ccd98d1851e8f7a2438344d52249ffc663dc026823040fabef02cefe3d0b84685c37269334837c3f4540fa4ec6ad5cb996a76b92408c619e9d4cd9bcdd23c9f21041f0a96c2decda005a8037b6ac614ec9e7511ee24ea61c607309c2bfafab77c6b01a1762bb0900cc1b3d7e3101e2e575efc1f81f70aeb1de20813d0b9343cc3e8e5f29bae6a7f1f3c2922b263623dd6ee7d2d367f3ea945a43721b3689477e5bd0060dfc4b8737d534d17338859390d16a95b651718d3a8477680b63076fcc7b2e852ba40118544c0697cafe5bde454c9363a02943098bf34993c79a097c965421cba89ca27e357ceb78a7fd1497912d559250dd80589c76e0879ffd80ad4bf4985223b2e4e2d167c1847f744b91b67fd84a3d52caad14d4019e9eb449c1f40499d81369f19de6326564597297fe369cb26cd4577ea5dbb6f1f05685a4d428b9a491f92a4406168e8a754acd82d6387ca22e4a9a4c8a3042d7624ec0f3e332f1026aaf06c43bf55dc9ea8e61f631eff4c153480fbc7d6f81d49843c5045f367bc77680e40b54d54ba32f839fe96638cdd2648b642ca319a022e9c650adc132837546cdaf47b7dde377c45a0fb86df51e180bde73336fb90e52eae10d13ad6c37f0cc68ee52abb828a1ce0882bce36e83a67aee29f9c7ee535b5f7fa1051ffab957a700e60f9225210fcd5ae8e26b976d9b200fe37334674b926ccef170d8c440e83e50fa00ff905a537b56b5ad04f6710e492f492178758b01813835138415614e76408da82d83fc0a861c9d3441a0ed3070c32a64357e25323f8cb928837e4bbcb092588181d2b23db6b5a7913e4a9199fc6fedb09cc4848fe0e5ff5974660f00db9c713a21a3bf13d2da58b435d34c126aa73e84da9506170fd003c1ccd5c2949a87724600779de7533870a0d7cb3d66857903873d730a71871d0286bc874b4ac153217151a5ac392179b4fad6546db0b079a2ceb5526abe1c5ddcf186e601f1037f0d55924ce61f92c8455cf09ee34544058b3c6df7052e60f8c52ae609d30dc56b174d8aa50f93a18696e4637a3632e1bf23bb81162fecdb581c38cedb9db34b3695037d98202a438de521614829d0e4d361bbbbdee15cad88d27bacf6fe63f9457404f401634f1ffbbb4b79dbbf9d18d273eee8551f856c88a71832098d2b20a7148cdacf0ade7952991e75287c11798111db28444db41d21815624a7d93795985455f7b2b4fdeaf15c51f36ede8e1573ddf2763491d65a98c6b95a94e4b5c288a62e683791c952b491b5a365deb7cf52cf91f51904f8b400276f62a29e4795e7f2f37cc036c6af69c22e3e53251160dcced3a8ee3b8e5f01c3fb2856cfa86e6a75a72d5f56ce7ce36702e1aa5d1e28825298a9fa0c09d428cd35a018117880265e190b453f84283b6acb03b67a035107f0dec62cd9d759db49e870fafd0b81266726d616f1adccf14a8daf9de615d9fbd8d6e058f528ef7bfe32e5d7ff0e7c83980a952a89a64deb665a6c88d6e03fe2d278814338cda683991a61729df51ea12e59cabb98359650481ae66cd2e45e725c8bda07e0a224473cee5bc8f1cdf774627a7540580c999d9d2fa33cdd87f9e23796a9976197932e62164b8a3409e3167c053fb2d709f6455e397b72c249769dc610546cffb59cc76f4b6491d1bef9783bfee98477fbce2aac0fc6e159be415bc85a44f429d9e208cf16ddfcd94302618aa1c7c0eb2481e7d07c27141beaf4f0766afcd394616fc6e40bdaef29e528e9e85b258ea59ec3ec52052dbf4db6d720288be70abd6d2d723e5f6f7bfb49ac62b832342c0b59bd49cf4f3884725d4b6f73bc3110d1b3f7299d4efa8f96f9f8ad68aa0060a2b75ae57391865041ed2ae83d54cb97923984abd34a80e60acd39b6f40c6b985a9738f14074045f68339b0b2837b5ea409096a7157fcfb7aa6be2ec75e0d37448a2e06b5f52ee76be322c30f29ce32ef20021d906d1758da9affa7591fdeead08d790611075631385fc2ce85f76d3348dc05d578efabcde6120a107c15aa9c85ff9f5af0a8b13627545b2cb91e172d0b7b01d68e1ed9d29a3c353777c968d2a6f1e5d25581b28c20228f4b07f1f996049ffd1c896fa9367b36532e96500ac61df60ea3386d562c3b0d693c48fcf5eaad49e7008ab987db483151403f3d3a8ce9f1ab8d7bdc2269246510aa36ebdca62d2ec68b8e764d629584f70dd20f9a2edc46e1624fc1594b6d279147a339f09034b22fea41bd603877926642a446837fafbaf153ae78608b55f25fa1542f29893bd038e2d6dd5d43e1afcd7d28832205e398bf101d1d3068c77abae2160186d73877421c490e0dd0071e040b1e488cc509f2590dba17d5ed35842e6c8f68d7bb68ed136f249437beccf8cef5b6011301eb3df166e82e59f870c6825dba5f72969bacb3c2ea14ab056f541289cb23622d1dad67bf9a6dc910f5eed2a601c16d9c7d5717a8652f8c676b0227255c91ae39b64b821a9f2258b5130243931e167549efe995a67c1f9ed982b50dbf435088650e1d32f702ff37aac1b33bfe8b2b9e4e3c43a00fb6c6a8ed4a859bbae1dedc019af84a3d0b4ac1a99901e34476f190999664e85777b0944492fb043181d388b96d3abe501025edab142b7124bd09486c50758847a14452e1534a11948067cb4f93c9d09af5b8dd2a7c66ccd99018b8d612622dc943d3a98a7288cd9ed4d86d1fdfac9e95ba13db5925999e8f5755c27fd18c1754d71c43731ea5b1736c9de2d971902740a2740739700a22a469907b0a9136d5086826d63c0fd6a56ff22e5005cd3bd549b4174c0c98af0357a8ef659bcea6a4d36abcd463252454a48dbb26d9b48cc187a603f160a608d2e0a3914a46ba370e7a418a2b2d0745198f545ba1a1058f589ccff8f554a607b1d8d80fe124558a9e4223357a0924004a2f37a6ff1dab5862f7b3fec24e3957f17fa53331fd4e4104d43db04c0dec31f32959795680f9e6bb7634f66e897208a8e8fdb530ee8657e9951645dce52b0b2dacc87bc84388dd9e86f7b9e4d31fcfc18946a928dc93b89673bb188286f45b2b047d7efe1ef27b9b6a157488b47ba42a810ac119755425e950182fba632f077e9e01f324f08cdd782cb4e8949e464dc64b894973394b621b48c37f015d7e276ad55581687b576715ea5b9995b832026e87eb79f60a87afce04fe83d691ee0f09f31f8faf2e4a938a5d09d98f5690d6a150b49a17f29681b9adc256cef17452e4d92cf15fc241e187f51c371b007c7070fcf1aba9b0a127f99073be011745ed191855275e96574908f5d44cb6615f73acc57811f06204990d28b7a9aae68b65e70d44ad2293657981f59bf052d515297c419fa0450a1f66d90000f6a24cc6f7c05e9a380134f278aa1dbb55a7b608131a11f9fbef1c7aa630cda15aefcc55320d289915221dc80456a98aabf3371a494dcf5a6681772ce7a6c60d532cd7cac11f1eff73db15e17411d6cc7d4e3937bb499d51008a83f18fe9bbe06b03433416d521025a623be5326f82f2b3d762553319fa4e5ebf18491a8ba2731ee79cb9bad9d61dadbc4108c1138650f6124b1d61c1549c26237f4ed5d775cce7403c106b845fed0e2a643a32ea3d32ce33418e79855dce42ae2ed95bc18779026627d0ca55b37c0bb16c75f3add4225819d99bfc1b12a854c7edf399e511fa302d375ed16172f2900bf526da817972303f70fc3ac075bc59c6e159eb740629228b05dadd971f5071f3721a35ad4ab82c7ba639f31a0e69b1c80978b10e32f3c77fa10caa1cfa5f37731ed3d0cf9ef9a01b9a874429dbd12199dadff166e5c5f97ed158f64a877287e1e110e199d8f805ee1ecb79acc131ba314987882c80dbbc6c43199140488b29af9fe0e94b3b37262559d4a7665855e96f089caefb5cd43242ba784a593d9c2646ca4488232bab4de578cbd93700b758267c10d8f74325a0b0d3305f7f821bd9453588c85996056e47cf6b56e588b36bc0b38114c83733b5dff3dac7157e3e2261009bfc2305e0938245081382eaaf5274e296dd25fd9bb3342e119c51de964501913d99b0561a0cd9f3568aed832334e0404afc259ba168d716125dbb8b1d4d3fd49903f1c64834310721ddf4d3dcf2b12d886dce273e1d8377a1541fdf4cddd9673982b591284c7fe3b019920c1f78e6e9bcb8f2a373c3dcbb9f42dca5c38c8ced253464e01630b67b419a2a0922e077368e94fbe3050d64d5927f04395ff367e5d270571b4ce241fd7e99a0f0daee9e8548fda566448a6fd33782320c251cc74ad10e47974c3eb7e1159571347fe64761afb177c9a5f68cfb0931cfef85219e0fc11ea78b116d2f4a7ef8cb5b91edf032b05029e94ba310843d621755bb2c4dcd6712974b2f185e3c7957a4952e7d2a2de11190e1f1ba46efb8cf6db5e5162ea136e8fe96f9693a22fb846fd5bf1046ae77f2576000798e812722eeac958cce01f96426886a9cc14ac3aabe12affec5fd376539a46e80e400be941ad6d280b256905e29b801e5071a57de68fb99854dd74fab96cc54d88ea0c5db77c64ca3d7f06b6b626e0e8dc52776eff97f447ad13ec14c3fc00601f4ed2e10d6ce9475e68d1815d029bc0f24ce951c063f8438db820d07a84deebc3152a5c534cb96a87b73dde98b457ccc78b297ddf72aba81adf32c5a3ed4d48da97ff2df601381dceb64acd05e630e69af24054526ebfffcb82ef156d2d0a153bbcacb9e0e6a8d740c4d1524a69f60b4ff75fd1819e40b1a33d07b288a1bebf90f31c831ddb2ec68dca1ba644517ec820cd34dad3c141bc8b6982e7f9b08ec116d7939ce75f7485f50176f2fce9669755eec0bc5fcb541789d8a5d1ecba08f736c571e9456684ef3c300add3fbac607868ac4f7c800ffdc6005ce660e630243dd8728ac4007af9ff73d86dfdee5a0f6d77ade39a2022e2d8f4f7a4bbb325e19811fe9a13e6474515962b73c3f4b8f7a5592e82318d70f5f93da83cff36dbd1c31dd5cdf18d1a13563d6da965cd0e676be77825ca7608f6b5be895e18cd9f1e47547cb7d59c509f05cf03f503976d87cdb3834dbdfdbc1151316ed651d5c63f92e9fef90ae7ef243a0a95270c252606f079ea27c7d2967f682eab1bfbac18f9ee0a490b500fb1d9f7533d8e7173f0b079c8dfd0c8d71edc59c3612ab88f086c012bebcd8ebd39a62919f35f8a2bc5e7cfa33328beb7c1ba1a13a84a8a9bfe5a2389c4fb65f7371d8b38d63ce7605988ad655db2345c9a1b19e22c6e57376cebbc69fe6bf79a5fb7efea312ecf482fe2df7b96357dc86672b5a577efcff10aa545a2d8c94efa1e760a78bda8dc5938e95713e76e93688298d287d9fef4e2dd9174922530e76239f9c0399acb10b9c7526913e3cd7a7fd86c48394c69df05932bcae23e75690218eade133e8746d06add4f3c461a0ee774a3b6db862d899a516ddfc3bac3af144fda982ed33cee3d53b70ba265a06dfd81e1262e05e6377f8844596e534ed80d4c64461b582bab683d1841235a0ae9dffc04b1cda71d168f5873216f27ec55844fa87406a97a0e0fef04645a9d9a32e161152e06e6d0fc202f8cab9ddce603a10011c0a2e202e450d4b5457645551e3b060664959f4fdeadd861cf1894354ce621b8c4a642fe971cd0a1f41a7bd1476b379c02b06685ef62a12ad5322db750057c83477433cb7636b75a677355697d884d7bc4a7f954c101a439fabdd291c6f93740a61b8e37bc265471ec9d8a20ad555e297281343d7dc878c61acacd866888dd567decaf9b6054a3ebdf6dd747c0987d188b9bafd7aa544e6d3a5c018d6fcc6b14ea3578f5d0ad1f090de2a69223d9ffdf7a0f4716f521d53539b5cec6d4ce41d9ace2d897e15fbbcdfeebf6023ecd3fb786f852e3260fb0d06813510766f4b477f766a8bc0e73df49ad79748222419c33fff0c1da83ba2bf4fe096ac1dd9b841687f735943be42a898c31612b47155a8af87773caec4254bf1c30d15639d3c3bea7f78db9882ac756f11309c034096697dbf151ab76457a43a7ff961181e3dc4b8b0b88041ca7e9b4b059bc7b580308d86a91671efb4e370c4f81fa6d3043a49e47be6f2bdbec2084c329e77075b9a6fc28a70ef186a396a95ab85ef5b3ac1674782b222470ee6f6688fb94c44ee61bb0aae658ac8ed36ee3c62f7b7882088f4ae5d5cb6e7446d74fe284f8884b9f89a60112e8144013d534c43acd4bee36852e22abbf6a5832f2cf1f2b14798ea18b7b689a49f031e90ecb0ff2966a39bc85381024568e6f8d80bcf7bd91d7431c1348e28308a6c06489f336d69069f6c32e5a079628c449542f24a86b6693e6689ade051c5abc69afc0b06428ea700ecdd1c261b90e442acf9118ce0a75b0965190a3c5bc9ed84982005b9c8044987a64ac0d8075a1ae3be9ac0bf331ac28122d9df4c86813a4b6a9970a98b4d16b3b7fa25821fd67883dfb03dde2680278ab90f4109e3d80ca1066e8810402feadfe1467074dfbd8d54a6e0f6c876090014584cd6be818c6517342dea29944847fdc00d6a76054fff380055896b41923ec7caf1af1907d832ba436bc53b220eb190e879875ef919b35286e0c59593db37ae325bb7567a68e066ee18e9cf628beb804494f8f5faa8d412feacc5dda1f0bbe1b3a971b483600376c637003e990785f929abf1509e290b1c0c915bfcf9248b5c20cbab1fa96daba65e81d9d5a8aee4703c3c6f634d4357831d3e1a2cea4b971cf70f930006bc625136d2944659aeaaa71b05f35f8db02589d6206a5b7fd1f6fd2cbb4ba2a0fc31420f54f2dc1ed5db61d7216244f7de5a06ea47bba2730a301216953c4e418c1438e1682b6f341a105d417cbb7e0dd5a3ca45398744ecdc24ef0e6e89143a112997307ffa2507feb1e8c9e352f01650b98ca7f6a2bad500667cffc6821c663c72b707422af4dcebe7747e34d422853b852849cc1c3e76144ac01cfe84c87d3589a79caf046556612a80a3a5f51ec228e7b427fcccc014303d3957b7b251fdd52644e94cb1f85cc2c7414b8e5e55322b236e1ae030dd66123d871c8fd4acbaf39185a779977f7b0576bbfd83061f9be2b15be3fbafe040e17ed91318baa89d528a30c901983be1099c96e9bfc8af2f63ba27a656a24d127bdfe3bb42bec25f51c971391c9017bf67a74d3f01cfc2dfa9271307eae2bb0c882420f72b3ed4e7a40264461d5aecfcdfb00d42f98e9f3f9f594b50b257cd40f260e8a08f3a79e14673b4575f2b71c68d67cf13399f1ba8f7c8f3a8bed63eeabec5364274af80e6fa66d2e15aaaef6d4d8e0cebe7109564c71654f7218ca00a2078bfb538f2c8c4feb4a5487f30dc230a4c2c15d757d4143e67b3d010fbc8b69f50a33fd9657a3d6aa236c45406f27d2aa64848e429d8a79d2861ec0e475a358fc27329945d4241c33bc79c72b29fa36971deff3b2f8521d192efe6fe6f58a34146ca6347f34fb0535afb319cb8a4a9778b7acc9fd30032e3ad775ebf39dd42e9e03dbf3108858ce857049a48f5052b44ad858b545675e756da62ab2b72659b2488188ec91b750297a2361b6e4b22646af8c0d2d83d1e97bb6365bd91adf49a5d25c74d847a9cfccf383d26c591d18cb3e64af4a94474a3531e35932f171850e37a47c2e793cfdaaf8cfdcd609818f689b4fac5d9e456954ddbeb21e8a9e4b32f2df9da96605ca8d27c862820c150ccaaab12842159f74652a5aad199aae95f1c6725d761499cdc607172e94a3e419f34884d217fd9f1144ff704dc78c977667f6a48dfb79f4bc219ce16d0005cb8f90cef91b78330acef210f6120115690ac889484356d4156b81f5cf7b1a02609524b2d2dbc3f8d2a839f4c09fa2770252058c7754712c2e8586a979ddd8efb0fb3235f64a0933b6ebe94fef5d2b7d4c3823766b02f7565cdb9b9ea4b82dea5f7e37b8f9a1b41a0336841e4261372d6751ec76f8d2bd67df82d4cc15068a4ec42c989cbe9b6249e236a9827d2bd81b0e9138a3e96b113ae22937bff20f0f9711cd625253cde28815af8e1b580d9c586fe584c35133c22cdba9584bc4d5f0ea40029fcd876da08b5888cb576f16669c89e6f1324be8af79b54559e8fc5a1c1134560bcfdfb1afc4550bc3cf3cbbb0b73b72e521fe04b19e2c6dafea9e4b61026aed792d297c29290d536cecf676e1496c998db6c29ff091f661d0b4d7676cbd033f13475998ed993214cc58d44264886040d54f71efd2aecad34cf281b980efe1d0659a71bc100b6b59b059c121644bf8a518a29eedd374f5673340c81e8db52c48243ff3dc9c68b76f12dd2a1507a8482fa230606aa135d5dd6211d8c062ecad9f31f646259b298e4cc2b7f033b8fcfc43d7eb9eebc498f4f43faad89808c22abffd391f2a028fc74fcf8e9656451307a57d96980025cc7069701a5cf6bfbe5d38a5674578550421af8ed1c1ddebcd94ac62e3ac6eb8144b6f95c6016efd7536938663c70ca4784989e8ae004edad630104b3fcecb074d9aa30871d50b85c9e5a835d820d15b26153dc31e1b5773cd1fa58426955a41737b422cf2c9a1a2fa955a2690079b9ec0744ee2ac9d7253e19a42289f3e5d86224b941995bc82547a9f1dd708aa595b974c6ed70bc3db0fb22053932012c273e09cafed36432582051f97e92989139c54921deefcbd256e9059024dba601718960c409278e656ea3cbea9111bf2529b4cb4a9cb681ccb27cd3ef506821109206b80cef00db5aa446244438077553a54567f2a423cbb5d6154c45c5f5e0b6977cc8367a213e4337745b827a2b8e42b31c1fc25280c8566cf54167849ec6040439877f9768cf6cbd2408641334dfcec1544a84ef7f40fe5f174b346825d155408d444516c4dd9a84f5a8f8942ac6d8260a968816bb19e0bb8264ff046cd182dc9cac4f37ae312a1c70a4dc9927f1a45044e67fd1a77fd1f31e65183637f10a23f08c3a9dd4483780c582df86fbee1311b7561626bc6bdc1523d2616870e6db06652bf257449b19cb68d99cbc293711266515cd31294cb7a9ec72fdf44d58e610ae28ea7dab225ff6f5ab79915f3a6d157631be06b9ce97b191deec051115ed657589989103ec869bd0dbfe0521fb88ee4bfe16863a795547d04f568833e176370b8bd80f1b245fbd20927427d0d430f4a4e68bd740e9d6e99f0815c74a41cbda2e72bd366ca053ff3df6bc0042ee24c999c5f3154bc35ac45c061292752810867bdb65e19336de056da474ee24357026eb20ff00ed5cafbe361fb79911b166215081c16650c9ffd4b1641eb543b06a157a539c12bd43ca6605373d241397dc5237ab0cb9f63a48b9d7822e227c42699adee1a9463df1bdced35ca7e4dc60e26cba4c17f474526eea735ce594a1a8fa426afb054a960264855054dfd61dd9eae32585f04bb5821816d2e38fa4a43621ab1d6080d183d43ef81377eda90ae5968d97aa08f075f8758a68136283d9057fb395d5674bc6cf28f9fa63d8dee13b585fa193d6d69ea102647bcd3a1668faaa10a93c7437bfb93f7f3bbb5c7e3536b1ab26748482dea56d2618483bfed9f807198eab75ad6dd78b95e2c3f5079cb2eb497f8c25e5264eddb027425884c1113afe91103c589637758edd9293a5f529afe31b5e0ed5d525e48a29cbbdfa7b00b1e74534885df147a9c4577ee968a87210a69a261a4cd93885c482dad808765b2a6a8342d3e6a3dd9c94b7899494d3c0e74c235c07af336c47f39ae5332da1ec2e356fd8b527f40787756cff6a53220daaa35badf9b37685b988ea02ec5703a36b9ef5640e435905d72a1def66b9a65302a8461f25953efbb44c3ad6768ebb95446897d4290e9e6091bcd17ae0961aadcfe58d5ea47e1ff57d6a26808205411c4c50759fda58a2e09795570b4472212990073b22b5da7a9c83c13718992fbe22be6b1a59791733015c8428556501c4e091e4d0a95da071e68aa5fddce667ebd9b7f681507688ddaa375ec04ca464f6731771dad830ecc3879f29637967b7b402b350caa7145beaef74d9dfba479077ed22fc135a631205f16a90f350dfa85b572475b552f6d9de7cecc8d9578cf29c4c1ea638a8b7393da91043079639707407a8eb02df635975f288e71dd7ff78fe068a9dff15641e31653700bee4f7c9ef66e7329d7e06a9a0218dd1f6b53b229fe77a37b716c0615f148e0bc61cacd3fad5a629454a5120d9d7aab786818c86c1912f2616f88157fcc761616ddafbe808ef09db500f8f904adb5748ad99ad76da09ddeb385821d8599c09670db40b6908e40c9d2a05725bd61bc4b39853e8e8111293c7e839c1580d5892e3d1bae68da87ac0de9b8f6cce1b14080b5275cdd86273029388abd014688df6f4854f5a4e97769d4a91b4ec3ea9411372b14c25e32e19ec5cca281dd9ed75ab538457ac7011b1beacc913f5a8bf9ebdcd98c0aad8b95dbb94257824516f163539320af8ab36f1dac5c2a9a4ebab66ba2c9f49445826fda9fec0a8dbd5b6be50ebf1cdfb29970e603775ed2e29843b9aa376204a003ce10691a0c3ba8fe915875c9b71d677c65e5fbc9faa6467ce95779e16302aa19d643195516a4a0ca89b35aa8f085561e6c51233d016754351d6cf9cb76c898cf1ed2b60410a1159b8e56f20ce0c79186133429e8ea00d022fc50df332a5179241faf2a1237c38c2ed65743163c24c44829ebb81e1bca85ddef2a18ecbc27c995e14acdb6acee91430038f70f9a09b8a631723894a9296c3de685417ee9511cd94eaa9716d2314209d3ccb0e5ada4ff089ec5ee382c56ff7a25b560e402fea7db405033fff77a5172aa2043d3f7145a9fc2049ad3064bcc9a0519134279eac75005ae73cfcfda96958467125a3d1bc3bd2499e506b0dfd7c06fe489c0cc5484817a72ae07c9c6a79054cdc0dee772650157194ae8895411c18a4fdf0708b91ddeb02b8b9f8418ebd6c4f4dab3c4a0872e77c2602a1b06b495ab538c95b2e677be4053b17a94657dc58f95d6151e8276e135c91167aee2a0a6c2637b1747a087ea525716fec74f7f88be397158bf9ddb86db82a21b60f0b76fd8854278ad11050447f0462ebaf723af9941270fc35ac4b45e81e7a33b8c8c7ea1a853713c554da02249596bf0ca33867e15d841b6fbec4b463a006cf69e570b6276f6a9a58f85094cb6c2a714b80ce4607cebc757a061e5479d56a639d26ab827edbef2d9c08217076884ad8f88be6ec2645482ada27fc3477722f7b8041e28855596e4711b1a6415448746ab57f8ab5159fa6c8acbfbe099d8695986b9c66ea34d9424c7a7276e35664aae71d18e61d217799263bce142dcf1091b9bee5e8b90e8036abec18eaee4b0fa2c8bc9cea189cb81b3a364da6fd0e91054a5b1e50d813707018cd3144eeb25202556e04018f25f0637594090b5667f6b56f2041c7720646d2e252a347f8a985d57857a61117b84dc173e2b91815303a7059ad2f8f33947003fa3c04140686b762aead8afae02e6ba251057f175c0387b5a7d9dfaa8d5d514e4efe747bd37dadf4c20fa09cb2289c687bfd19831ff73b783991b62c254cb58262176ee391f33ea881927fae3096185bccb8ea07711ffc8ad69c687dc2a637d97fabaec2a1e62191e1d34f912867e3452c7585b3ec65cfaa5204e8a750fe28ff0ea6739b0dea2037c282d9ab0e8fa7fadd77168916e7feb94dd63f2ef39200e6dc6a446b2af3e7c129de2413eaa96eaf0954ff91e866a4196a0cee19678cfe38f30ddc9151c4099b206d88f219a2f8c273d97de6ae3b9ec47a3137a7b764f4f015f166c20529247dc6bcd7f3b3d32bdef93bce925e0efd355866fe33b88fc8e51503e4117cb0788b25901428e178c1229ed0f211a394fffd9cd17db47b1e3eeb77f430b33a5ab462b3f23df161215e54e4ac58aea34e103b91c4074333d01fda1e7c963d34f16b2b020789cf3343db0ad17681cdc6cd677daa568e82d06b8bb393c7757b8d873a6ed9b5bd5bb885f6cb4377f942a39272382da9d2e720db398b2079f48ea65b03264326acbd0dd1ba45264b21590f44fab6bf3b8b670696340af4ed6073d9e9e1d95f5a71245b2f124f71ac7a34c7d1cde481e6d5235fe58e7932b3c618ed998a498de925f371997d4fab315c6088711ef19d01a36e283131fdc6e286b6cd4dd9662da2951cc6aebceec610771fcaa342a82822c8eb59eb64f58cbfde7c41ec354306cafe8ef079b1cf10c11bfc55e004d93a0cb194a313e6e80711cbf9008b63ffb8524735c2bd0647cf8fe76f742e01bd8ab86fb46485268fac5d9d830534c19616e6fa30b3c0e4cb0d63c2fc0e9d9aaf028f7e58a995ef4b10c7ed32c2096d934abd37e8611991b336be03d836c085b7bf138b582a04d0fe5f1a5dfde1a17f6c703c8c1c546f585d344db63de8c3aafb9b358ddb382c7b189dcc0d4532239a201c1738d84bf637a195565d653a18a79c91278d0b83ebc81ee801b3050d59442f5665d48f96a41cabcb971c204446fdae8a1311132dab267e612d10e7c35f94be7c046d30a02ed5ef01e4cd81e71a47ed75f65939ffa9b142ddfb2b558a53ea58ca3553f48b5ee4c56872314ef3931f67c0b4b1bcbad7f467846e452670b5f9a0acae8c34b05ca20bc1fd625d3a80da8e235eb463e0c933075db5edb873fa4ecbe3b8f3288bf6c9d8739ccabd9932f114a235d169491672599c5a07696a8c91dfb75f069a083256305e4f9322f83d05e5c7f0a2d9e0c6c784489b25dac5ca2608ea8d08044f431574e907650df1f9847b9a2e415b7fbe8d258d4fcba9239ec1215200a23a70eccf2f91cadaef118b259dc95e73d932b76ce552df09a83554f1b2444fff6a2132e9dcd063ba49a138242e981664902f8dcf66751e808f0e75b34d04af7a427f496057b6b043aaa149f1177d5797b2ca612bdacc0a31f628dfc9bb5108f90db1f69a3240596f39c8c0b57d05542d6131ccf796f5656fb3834fafa24c5611acad7c230fd1755e9c09108455fd88cb4c4bfaa5ee7baa9edc15550ab38d70e98590042cf80459e12139a29e420b6491c4ee4345fd39736b71c974001748d86e27a05e2d9791221912a936159f37ae0ee7289fa2a1777ffd3fe26c6533d0b66cc75733a0c0bb78f4b76580c9a</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请输入密码访问</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019电赛——纸张计数显示装置</title>
      <link href="/2019/09/01/2019-electronic-design-competition/"/>
      <url>/2019/09/01/2019-electronic-design-competition/</url>
      
        <content type="html"><![CDATA[<h2 id="Github项目地址"><a href="#Github项目地址" class="headerlink" title="Github项目地址"></a><a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition" target="_blank" rel="noopener">Github项目地址</a></h2><h1 id="纸张计数显示装置😄"><a href="#纸张计数显示装置😄" class="headerlink" title="纸张计数显示装置😄"></a>纸张计数显示装置😄</h1><p align="center">  <a href="https://zengwangfa.top/">个人主页🕺|</a>  <a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/blob/master/docs/%E8%AE%BA%E6%96%87/%E7%BA%B8%E5%BC%A0%E8%AE%A1%E6%95%B0%E6%98%BE%E7%A4%BA%E5%99%A8%E8%AE%BA%E6%96%87.md" target="_blank" rel="noopener">电赛论文📚|</a>  <a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/tree/master/software" target="_blank" rel="noopener">软件说明💻|</a>  <a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/blob/master/mechanical" target="_blank" rel="noopener">机械说明🎮|</a>  <a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/tree/master/hmi" target="_blank" rel="noopener">交互界面说明📺|</a>  <a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/tree/master/%E7%BB%BC%E5%90%88%E6%B5%8B%E8%AF%84" target="_blank" rel="noopener">综合测评📐</a></p><hr><p align="center">  <img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/logo.jpg"></p><p align="center">  <a href="https://www.stmcu.com.cn" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/Device-STM32F407-brigreen.svg?style=flat-square"></a>  <a href="https://www.rt-thread.org/" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/OS-RT--Thread-brightgreen"></a>  <a href="https://img.shields.io" target="_blank" rel="noopener"><img src="https://img.shields.io/github/repo-size/zengwangfa/2019-Electronic-Design-Competition?style=flat-square"></a></p><h2 id="1、简介✏"><a href="#1、简介✏" class="headerlink" title="1、简介✏"></a>1、简介✏</h2><blockquote><p>纸张计数显示装置基于<strong>RT-Thread</strong>实时操作系统，硬件平台采用<strong>STM32F407</strong>单片机为主控制器，以具有抗电磁干扰（<strong>EMI</strong>）架构的FDC2214模块作为电容采集传感器，通过<strong>屏蔽双绞线</strong>连接至两铜极板，读取采集的数据并进行相应判断，应用触摸屏和语音模块进行状态显示与播报。FDC2214模块将采集到的数据通过IIC协议传输给主控制器，主控制器对原始数据进行<strong>卡尔曼滤波</strong>，抑制噪声对数据采集的影响。校准模式下，本系统利用最大隶属度法，确定电容模拟值及纸张数的论域，定义模糊子集和隶属函数，建立模糊规则控制表，求得模糊控制查询表。其根据采集到的两极板的数据，做出短路判断并读取多组实时数据，将其与模拟区间进行归类，选取<strong>最大可能性区间</strong>作为期望值，减小最终判断的差错率。</p></blockquote><ul><li><input checked="" disabled="" type="checkbox"> 成果：在校准好后，50张以下<code>100%</code>正确</li></ul><hr><table><thead><tr><th align="center">配置参数</th><th align="center">主控制器</th><th align="center">配置参数</th><th align="center">主传感器</th></tr></thead><tbody><tr><td align="center">芯片型号</td><td align="center">STM32F407ZGT6</td><td align="center">芯片型号</td><td align="center">FCD2214</td></tr><tr><td align="center">CPU</td><td align="center">32位 Cortex-M4(ARMv7)</td><td align="center">分辨率</td><td align="center">28位</td></tr><tr><td align="center">主频</td><td align="center">168MHz</td><td align="center">通道数</td><td align="center">4</td></tr><tr><td align="center">RAM</td><td align="center">192KB</td><td align="center">接口</td><td align="center">I2C</td></tr><tr><td align="center">外存</td><td align="center">1MB(FLASH)</td><td align="center">最高输出速率</td><td align="center">4.08ksps</td></tr><tr><td align="center">单元</td><td align="center">FPU、DSP</td><td align="center">特性</td><td align="center">抗电磁干扰(EMI)</td></tr></tbody></table><hr><ul><li>系统结构简图：<br><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E7%AE%80%E5%9B%BE.png" alt="系统结构简图" title="系统结构简图"></li></ul><h2 id="2、目录说明🔖"><a href="#2、目录说明🔖" class="headerlink" title="2、目录说明🔖"></a>2、目录说明🔖</h2><h4 id="STM32F407控制程序在："><a href="#STM32F407控制程序在：" class="headerlink" title="STM32F407控制程序在："></a>STM32F407控制程序在：</h4><pre><code>+——2019-Electronic-Design-Competition|---+ software:【软件设计】|       ├──README.md|       ├──rt-thread-master|            └──bsp|               └──stm32f407【控制程序】|                  └──project.uvprojx【Keil5工程】|---- ...</code></pre><table><thead><tr><th align="center">目录名</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">2019电赛题目</td><td align="center">2019年电赛A-H题题目及器件清单</td></tr><tr><td align="center"><a href="./docs/">docs</a></td><td align="center">数据手册、设计图片、参考文献及设计文档</td></tr><tr><td align="center"><a href="./hardware/">hardware</a></td><td align="center">FDC2214、核心板原理图及PCB</td></tr><tr><td align="center">hmi</td><td align="center">串口屏幕设计UI及交互程序</td></tr><tr><td align="center">matlab</td><td align="center">matlab函数拟合及Kalman</td></tr><tr><td align="center">mechanical</td><td align="center">机械结构设计</td></tr><tr><td align="center">others</td><td align="center">一些关于电赛前的准备</td></tr><tr><td align="center"><a href="./software/"><strong>software</strong></a></td><td align="center"><strong>纸张计数显示装置STM32程序</strong></td></tr><tr><td align="center"><a href="./综合测评/">综合测评</a></td><td align="center"><strong>综合测评题目及Multisim电路仿真</strong></td></tr></tbody></table><h2 id="3、机械结构-hammer"><a href="#3、机械结构-hammer" class="headerlink" title="3、机械结构:hammer:"></a>3、<a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/blob/master/mechanical" target="_blank" rel="noopener">机械结构<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f528.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f528.png?v8">🔨</span></a></h2><ul><li>3维模型<br><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/3D_structure.jpg" alt="3D效果图" title="3D效果图"></li><li>实物图<br><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/metal_struture.png" alt="铰链结构实物图"></li></ul><h2 id="4、软件说明💻"><a href="#4、软件说明💻" class="headerlink" title="4、软件说明💻"></a>4、<a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/tree/master/software" target="_blank" rel="noopener">软件说明💻</a></h2><p>应用线程总体分为：</p><ul><li><p>1.简单设备运行线程</p><ul><li>LED</li><li>OLED</li><li>Buzzer</li><li>Flash</li></ul></li><li><p>2.主测量应用线程</p><ul><li>HMI屏幕交互</li><li>FD2214数据获取与转换</li><li>语音模块交互</li></ul></li><li><p>3.系统监控线程</p><ul><li>Watch Dog<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f415.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f415.png?v8">🐕</span></li></ul></li></ul><h2 id="5、硬件结构-artificial-satellite"><a href="#5、硬件结构-artificial-satellite" class="headerlink" title="5、硬件结构:artificial_satellite:"></a>5、硬件结构<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f6f0.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f6f0.png?v8">🛰</span></h2><p><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/Controller_3D.jpg" alt="Controller PCB 3D" title="Controller 3D"></p><ul><li>核心板(Core Controller)拥有外设：</li></ul><table><thead><tr><th align="center">外设名称</th><th align="center">RGB LED</th><th align="center">Key</th><th align="center">Buzzer</th><th align="center">Dial Switch</th><th align="center"><strong>FCD2214</strong></th><th align="center">USART HMI</th><th align="center">OLED</th><th align="center">W25Q128</th><th align="center">Voltage Detection</th><th align="center">Current Detection</th><th align="center">Zigbee</th><th align="center">JY901</th><th align="center">USR-C216</th><th align="center">CP2102</th></tr></thead><tbody><tr><td align="center">控制(通讯)方式</td><td align="center">GPIO</td><td align="center">GPIO</td><td align="center">GPIO</td><td align="center">GPIO</td><td align="center"><strong>I2C</strong></td><td align="center">USART</td><td align="center">SPI</td><td align="center">SPI</td><td align="center">ADC</td><td align="center">ADC</td><td align="center">USART</td><td align="center">USART</td><td align="center">USART</td><td align="center">USART</td></tr><tr><td align="center">功能描述</td><td align="center">指示灯</td><td align="center">按键</td><td align="center">蜂鸣器</td><td align="center">拨码开关</td><td align="center"><strong>电容传感器</strong></td><td align="center">串口触摸屏</td><td align="center">显示屏</td><td align="center">闪存芯片</td><td align="center">电压检测</td><td align="center">电流检测</td><td align="center">2.4G无线通信</td><td align="center">九轴</td><td align="center">WiFi模块</td><td align="center">串口转USB</td></tr></tbody></table><ul><li>整体实物图<br><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/all_structure.png" alt="整体实物图"></li></ul><hr><h2 id="6、交互界面-framed-picture"><a href="#6、交互界面-framed-picture" class="headerlink" title="6、交互界面:framed_picture:"></a>6、<a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/tree/master/hmi" target="_blank" rel="noopener">交互界面<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f5bc.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f5bc.png?v8">🖼</span></a></h2><ul><li><input checked="" disabled="" type="checkbox"> 电脑调试时的交互界面展示：</li></ul><p align="center">  <img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/github/paper_hmi.gif"></p><h2 id="7、测试数据分析-bar-chart"><a href="#7、测试数据分析-bar-chart" class="headerlink" title="7、测试数据分析:bar_chart:"></a>7、测试数据分析<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f4ca.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4ca.png?v8">📊</span></h2><p>(1)<br>保持测试环境不变，采集50个样本，通过MATLAB拟合出纸张页数与传感器原始数据的曲线关系，如图4-2所示。</p><p><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/fitting.png" alt="拟合曲线" title="拟合曲线"></p><p><strong>图4-2 纸张页数与模拟量的拟合函数关系图</strong></p><ul><li>(2) 根据(1)中采集的50个样本，确定电容模拟值及纸张数的论域，划分模糊子集，如表4-1<br>所示。</li></ul><p><strong>表4-1页数与模拟量区间对应表</strong></p><table><thead><tr><th>页数/张</th><th>对应模拟量区间</th><th>页数/张</th><th>对应模拟量区间</th></tr></thead><tbody><tr><td>1</td><td>[1680.00,1345.34]</td><td>6</td><td>[682.48,633.84]</td></tr><tr><td>2</td><td>[1345.34,1013.26]</td><td>7</td><td>[633.84,598.03]</td></tr><tr><td>3</td><td>[1013.26,845.12]</td><td>8</td><td>[598.03,569.46]</td></tr><tr><td>4</td><td>[845.12,748.79]</td><td>9</td><td>[569.46,546.28]</td></tr><tr><td>5</td><td>[748.79,682.48]</td><td>10</td><td>[546.28,529.16]</td></tr></tbody></table><ul><li>(3)根据（2）中划分的模糊子集，保持测试环境不变，固定测量35张纸张，采集数据如表4-2所示，采集到的原始数据90%落入35张页数所对应的区间[401.35,399.50]，如图4-35</li></ul><p><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/35page.png" alt="35张纸区间图"></p><p><strong>表4-2 纸张数为35的实时数据</strong></p><table><thead><tr><th>测试组别</th><th>原始数据</th><th>测试组别</th><th>原始数据</th></tr></thead><tbody><tr><td>1</td><td>400.896</td><td>6</td><td>400.824</td></tr><tr><td>2</td><td>401.049</td><td>7</td><td>400.591</td></tr><tr><td>3</td><td>400.157</td><td>8</td><td>401.111</td></tr><tr><td>4</td><td>399.912</td><td>9</td><td>400.443</td></tr><tr><td>5</td><td>401.125</td><td>10</td><td>398.529</td></tr></tbody></table><ul><li>测试结果</li></ul><p><strong>表4-4 工作模式下纸张测试结果表</strong></p><table><thead><tr><th>范围</th><th>测试次数</th><th>正确次数</th><th>正确率</th></tr></thead><tbody><tr><td>1~10</td><td>25</td><td>25</td><td>100%</td></tr><tr><td>11~20</td><td>25</td><td>25</td><td>100%</td></tr><tr><td>20~30</td><td>25</td><td>25</td><td>100%</td></tr><tr><td>30~40</td><td>25</td><td>25</td><td>100%</td></tr><tr><td>40~50</td><td>25</td><td>25</td><td>100%</td></tr><tr><td>50~60</td><td>25</td><td>23</td><td>92%</td></tr><tr><td>60~70</td><td>25</td><td>20</td><td>80%</td></tr><tr><td>70~80</td><td>25</td><td>16</td><td>64%</td></tr></tbody></table><h2 id="8、综合测评演练-triangular-ruler"><a href="#8、综合测评演练-triangular-ruler" class="headerlink" title="8、综合测评演练:triangular_ruler:"></a>8、<a href="https://github.com/zengwangfa/2019-Electronic-Design-Competition/tree/master/%E7%BB%BC%E5%90%88%E6%B5%8B%E8%AF%84" target="_blank" rel="noopener">综合测评演练<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f4d0.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4d0.png?v8">📐</span></a></h2><ul><li>选定2017综合测评题目【符合信号发生器】，进行综合测评训练<br><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/2017%E5%B9%B4%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%94%B5%E5%AD%90%E8%AE%BE%E8%AE%A1%E7%AB%9E%E8%B5%9B%E7%BB%BC%E5%90%88%E6%B5%8B%E8%AF%84%E9%A2%98.jpg" alt="2017年全国大学生电子设计竞赛综合测评题" title="2017年全国大学生电子设计竞赛综合测评题"></li></ul><p>虽然测评训练的时候做的还行，但是实际当天综测比赛的时候，还是会手忙脚乱，现在想起那天焊接电路颤抖的双手都有点好笑<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f923.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f923.png?v8">🤣</span><span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f923.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f923.png?v8">🤣</span>。</p><ul><li>综测训练测试结果：<br><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/2017%E7%BB%BC%E6%B5%8B%E8%AE%AD%E7%BB%83.jpg" alt="2017综测训练" title="2017综测训练"></li></ul><h2 id="9、分工-family"><a href="#9、分工-family" class="headerlink" title="9、分工:family:"></a>9、分工<span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f46a.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f46a.png?v8">👪</span></h2><ul><li><input checked="" disabled="" type="checkbox"> <p>电路设计</p><ul><li><input checked="" disabled="" type="checkbox"> 硬件搭建 by <a href="https://github.com/zengwangfa" target="_blank" rel="noopener">@Ian</a>    </li></ul></li><li><input checked="" disabled="" type="checkbox"> <p>控制程序</p><ul><li><input checked="" disabled="" type="checkbox"> 整体框架 by <a href="https://github.com/zengwangfa" target="_blank" rel="noopener">@Ian</a></li><li><input checked="" disabled="" type="checkbox"> 交互界面及通信 by <a href="https://github.com/zengwangfa" target="_blank" rel="noopener">@Ian</a></li><li><input checked="" disabled="" type="checkbox"> 核心分割算法 by <a href="https://github.com/Okurarisona" target="_blank" rel="noopener">@Okurarisona</a></li></ul></li><li><input checked="" disabled="" type="checkbox"> <p>机械结构</p><ul><li><input checked="" disabled="" type="checkbox"> 结构方案设计 by <a href="https://github.com/JackyLin1205" target="_blank" rel="noopener">@JackyLin</a> </li><li><input checked="" disabled="" type="checkbox"> 固定铰链式抗干扰结构 by <a href="https://github.com/JackyLin1205" target="_blank" rel="noopener">@JackyLin</a> </li></ul></li><li><input checked="" disabled="" type="checkbox"> <p>论文</p><ul><li><input checked="" disabled="" type="checkbox"> 论文 by <a href="https://github.com/Hyf338" target="_blank" rel="noopener">@Hyf338</a></li></ul></li></ul><h3 id="赞赏"><a href="#赞赏" class="headerlink" title="赞赏"></a>赞赏</h3><p><img src="https://zengwangfa.oss-cn-shanghai.aliyuncs.com/csdn/%E7%BB%99%E8%B5%9E.png" alt="赞赏" title="赞赏"></p><h4 id="整理纪念"><a href="#整理纪念" class="headerlink" title="整理纪念"></a>整理纪念</h4><ul><li><a href="Mailto:zengwangfa@outlook.com">点击联系我</a></li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello Hexo</title>
      <link href="/2019/07/24/hello-world/"/>
      <url>/2019/07/24/hello-world/</url>
      
        <content type="html"><![CDATA[<h2 id="1-参考资源"><a href="#1-参考资源" class="headerlink" title="1.参考资源"></a>1.参考资源</h2><ul><li><a href="https://github.com/hexojs/hexo" target="_blank" rel="noopener">Github Hexo</a></li><li><a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">Hexo 官网</a></li></ul><h2 id="2-安装软件"><a href="#2-安装软件" class="headerlink" title="2.安装软件"></a>2.安装软件</h2><h3 id="2-1-Windows"><a href="#2-1-Windows" class="headerlink" title="2.1 Windows"></a>2.1 Windows</h3><ul><li><a href="https://git-scm.com/downloads" target="_blank" rel="noopener">git下载官网</a></li><li><a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">nodejs下载官网</a></li></ul><h3 id="2-2-Linux"><a href="#2-2-Linux" class="headerlink" title="2.2 Linux"></a>2.2 Linux</h3><ul><li><code>git</code></li></ul><pre><code>sudo apt-get install git</code></pre><ul><li><code>Nodejs</code></li></ul><pre><code>sudo apt-get install nodejs</code></pre><blockquote><p>安装完成,查看版本号,可检查是否安装成功</p></blockquote><ul><li><code>node -v</code></li><li><code>npm -v</code></li></ul><h2 id="3-安装Hexo"><a href="#3-安装Hexo" class="headerlink" title="3.安装Hexo"></a>3.安装Hexo</h2><blockquote><p>以下命令都在<code>git bash</code>中输入运行</p></blockquote><ul><li>cd至需要创建的文件夹blog下，安装Hexo（Windows在<code>git bash</code>窗口中输入）</li></ul><pre><code>npm install -g hexo-cli  </code></pre><h2 id="4-快速创建"><a href="#4-快速创建" class="headerlink" title="4.快速创建"></a>4.快速创建</h2><h3 id="4-1-初始化博客"><a href="#4-1-初始化博客" class="headerlink" title="4.1 初始化博客"></a>4.1 初始化博客</h3><pre><code>hexo init blog</code></pre><ul><li>切换至博客目录</li></ul><pre><code>cd blog</code></pre><h3 id="4-2-创建文章"><a href="#4-2-创建文章" class="headerlink" title="4.2 创建文章"></a>4.2 创建文章</h3><pre><code>hexo new "Hello Hexo"</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="4-3-生成静态文章"><a href="#4-3-生成静态文章" class="headerlink" title="4.3 生成静态文章"></a>4.3 生成静态文章</h3><pre><code>hexo generate</code></pre><ul><li>可简写为<code>hexo g</code></li></ul><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="4-4-启动服务"><a href="#4-4-启动服务" class="headerlink" title="4.4 启动服务"></a>4.4 启动服务</h3><blockquote><p>在预览时才需要用】启动hexo,会生成本地连接:localhost:4000<br>如果4000端口被占用可以用：hexo server -p 5000(指定端口5000)</p></blockquote><pre><code>hexo server</code></pre><ul><li>可简写为<code>hexo s</code><br>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></li></ul><h3 id="4-5-部署文章"><a href="#4-5-部署文章" class="headerlink" title="4.5 部署文章"></a>4.5 部署文章</h3><pre class=" language-c"><code class="language-c">hexo deploy</code></pre><ul><li>可简写为<code>hexo d</code><br>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></li></ul><h2 id="5-更换主题"><a href="#5-更换主题" class="headerlink" title="5.更换主题"></a>5.更换主题</h2><h3 id="5-1-下载"><a href="#5-1-下载" class="headerlink" title="5.1 下载"></a>5.1 下载</h3><p>点击不同的主题的代码，将其文件夹复制到你 Hexo 的 themes 文件夹中即可<br><strong>推荐的主题：</strong></p><ul><li><a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">matery</a></li><li><a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">yilia</a></li></ul><h3 id="5-2-更换主题"><a href="#5-2-更换主题" class="headerlink" title="5.2 更换主题"></a>5.2 更换主题</h3><blockquote><p>初始化默认主题为landscape</p></blockquote><p>切换主题修改 Hexo 根目录下的 <code>_config.yml</code> 的 <code>theme</code> 的值：theme: <code>hexo-theme-matery</code></p><p><code>_config.yml</code>文件的其它修改建议:</p><ul><li>请修改 _config.yml 的 url 的值为你的网站主 URL（如：<a href="http://xxx.github.io）" target="_blank" rel="noopener">http://xxx.github.io）</a></li><li>建议修改两个 per_page 的分页条数值为 6 的倍数，如：12、18 等，这样文章列表在各个屏幕下都能较好的显示</li><li>如果你是中文用户，则建议修改 language 的值为 zh-CN</li></ul><h2 id="6-绑定域名CNAME"><a href="#6-绑定域名CNAME" class="headerlink" title="6.绑定域名CNAME"></a>6.绑定域名CNAME</h2><ul><li>当你点击保存的时候 Github Pages 会自动帮你生成一个 CNAME 的文件在根目录，里面的内容就是你绑定的域名地址</li></ul><p><img src="https://ina-blog.oss-cn-shanghai.aliyuncs.com/CNAME.png" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>观想之宙</title>
      <link href="/2019/06/28/the-three-body-problem-x/"/>
      <url>/2019/06/28/the-three-body-problem-x/</url>
      
        <content type="html"><![CDATA[<blockquote><p>我看到了我的爱恋<br>我飞到她的身边<br>我捧出给她的礼物<br>那是一小块凝固的时间<br>时间上有美丽的条纹<br>摸起来像浅海的泥一样柔软<br>她把时间涂满全身<br>然后拉起我飞向存在的边缘<br>这是灵态的飞行<br>我们眼中的星星像幽灵<br>星星眼中的我们也像幽灵</p></blockquote><h1 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h1><p>《三体X·观想之宙》是一本由<strong>宝树</strong>著作，重庆出版社出版，为大刘《三体》系列外传</p><h3 id="作者简介"><a href="#作者简介" class="headerlink" title="作者简介"></a>作者简介</h3><ul><li>宝树：北京大学本科、硕士，新锐<strong>科幻作家</strong>。<ul><li>著作：长篇小说《时间之墟》、短篇小说集《古老的地球之歌》</li><li>多次获得中国科幻银河奖、华语科幻星云奖等</li></ul></li></ul><h3 id="作品目录"><a href="#作品目录" class="headerlink" title="作品目录"></a>作品目录</h3><ul><li>1.楔子</li><li>2.上部：时间之内的往事</li><li>3.中部：茶道谈话</li><li>4.下部：天萼</li><li>5.尾声：普罗旺斯</li><li>6.后记</li><li>7.尾声之后：新宇宙纪事</li></ul><h1 id="二、阅读记录"><a href="#二、阅读记录" class="headerlink" title="二、阅读记录"></a>二、阅读记录</h1><h2 id="1、本书主要内容"><a href="#1、本书主要内容" class="headerlink" title="1、本书主要内容"></a>1、本书主要内容</h2><p>  本书主线或者说<strong>主要矛盾</strong>——<strong>“主宰”与“隐藏者”的斗争</strong>。  </p><p>  什么样的斗争？隐藏者的目的究竟是什么？主宰作为宇宙之主为什么会有敌手？开头设定“隐藏者”这一新角色，激发了极大的阅读兴趣。</p><p>  本书主人公为被三体人所复活的云天明，三体人不断用残酷的梦境折磨云天明说出其真实的目的，但是这种手段不仅没有让云天明屈服，反而使其逐渐锻炼出超卓的心智。</p><h2 id="2、本书中宇宙十维模型的解读"><a href="#2、本书中宇宙十维模型的解读" class="headerlink" title="2、本书中宇宙十维模型的解读"></a>2、本书中宇宙十维模型的解读</h2><p>原文中<strong>云天明</strong>与<strong>智子</strong>的对话</p><blockquote><p>“三维宇宙存在了多少时间？”他转向智子，目光炯炯地问。<br>“按地球年来计算，大概是138亿9400万年。”智子很快给出了答案。<br>“四维宇宙呢？”<br>“100万年。”<br>“五维宇宙是？”<br>“131年。”<br>“六维宇宙？”<br>“九天。”<br>“七维？”<br>“两分钟零三秒。”<br>“八维？”<br>“12毫秒。”<br>“九维？”<br>“31纳秒。”<br>云天明按捺住内心的兴奋，问出了最终一问：“那么，十维宇宙呢？”<br>智子罕见地沉默了片刻，然后说：“永恒。在十维宇宙中不需要时间。”<br>“我早该想到，”云天明喃喃道，“无限的速度，无限的效率，一切从开始就已经完成，瞬间达到完满，不需要任何间隔……这是一个没有时间的世界。”<br>“没有时间，没有运动，没有变化，没有过程……开始即结束！刹那即永恒！没有活生生的生命，只是无穷张胶片的叠加。这是一个——死亡的世界。”<br>“我不明白，”智子说，“我真的不明白你在说什么。完美的世界本来就不需要时间。时间只是……令人厌恶的延迟而已。”<br>“因为你是主宰的影子，”云天明说，“和主宰一样，时间就是你的盲点。你根本上并不是生活在时间里，你也永远看不到时间本身。我给你讲一个地球的神话吧。”<br>“我知道所有的地球神话。”智子不屑地说。<br>“但是你不一定能了解其意义，不是么？否则你可能早已经明白隐藏者的动机。在希腊神话里，天空之神乌拉诺斯和大地女神盖亚结合在一起，生出了许多的诸神。但是乌拉诺斯厌恶这些儿女们，用生殖器把他们顶回了盖亚的子宫，不让他们出世，而天与地也处于永恒的结合状态，无法分离。后来盖亚因为被乌拉诺斯所包围和挤压而感到痛苦，让她的儿女们去消灭父亲乌拉诺斯，最后她的儿子克洛诺斯砍下了乌拉诺斯的生殖器，让乌拉诺斯离开了盖亚，从此天与地分离，诸神出世，宇宙万物才具有了生机。”<br>“这个粗俗无趣的故事和十维宇宙的事有什么关系？”<br>“克洛诺斯就是希腊语的‘时间’。这是一个隐喻，时间让一切开始。隐藏者需要的就是时间，没有时间的宇宙，再大都太小了。所以隐藏者无法忍受，必须要降维。每降一次维，时间就延长至少上万倍。隐藏者不是疯子，也不是恶棍，他们只是需要一点——时间。”<br>“对于隐藏者来说，降维就是为了创造时间，所有消失的维度，都将通过时间获得补偿。它们——或者它们的一部分——都以某种方式被转移到了时间中！这就是降维的积极意义！没有降维就没有时间！”<br>“也可以这么说，我们早已经发现，时间本身是对光速降低的一种补偿性效应。”智子若有所思地说。</p></blockquote><p>  宝树将起源宇宙描述为十维世界（完美的世界）——“永恒。在十维宇宙中不需要时间。”光从世界的一端传到另一端，速度无限。</p><p>  “无限的速度,无限的效率，切从开始就已经完成，瞬间达到完满,不需要任何问间隔.-这是一个没有时间的世界。<br>“没有时间,没有运动， 没有变化，没有过程….始即结束!刹那即永恒!没有活生生的生命，只是无穷张胶片的叠加。这是一个死亡的世界!”<br>脑洞极为惊奇，但是却也是漏洞百出。</p><p>这也揭示了<strong>宇宙降维</strong>的真正原因——隐藏者需要的就是时间，没有时间的宇宙，再大都太小了。<br><strong>隐藏者</strong>不断让宇宙降维，以获取更多的时间。时间本身是对光速降低的一种补偿性效应。</p><h2 id="3-云天明的主角光环"><a href="#3-云天明的主角光环" class="headerlink" title="3.云天明的主角光环"></a>3.云天明的主角光环</h2><p>  不得不承认是主角，在某种程度上都会有一定的主角光环，在本书尤为明显。<br>在其与三体人无限梦境的斗争中，云天明大脑的思想或者说意识有了超出常人的跃进。<br>其拥有能逃避高科技探测意思的“思想黑箱”——简单来说，就是将自我意识，放入自己开辟的“黑箱”中，躲避高科技对其真实想法的探测。</p><h2 id="4、歌者与“王”之间的凄美爱情"><a href="#4、歌者与“王”之间的凄美爱情" class="headerlink" title="4、歌者与“王”之间的凄美爱情"></a>4、歌者与“王”之间的凄美爱情</h2><p>  在<strong>星渊族</strong>即将灭亡之时，歌者所吟唱也揭示了一部分本书的秘密。</p><blockquote><p>我看到了我的爱恋<br>我飞到她的身边<br>我捧出给她的礼物<br>那是一小块凝固的时间<br>时间上有美丽的条纹<br>摸起来像浅海的泥一样柔软<br>她把时间涂满全身<br>然后拉起我飞向存在的边缘<br>这是灵态的飞行<br>我们眼中的星星像幽灵<br>星星眼中的我们也像幽灵</p></blockquote><h2 id="5-感想"><a href="#5-感想" class="headerlink" title="5.感想"></a>5.感想</h2><p>  宇宙处于无限归零当中，宇宙不断衰减，衰减至尽，则重现归零，不知是毁灭还是新的重生，或许对于现宇宙当中的一部分为毁灭，对下一态宇宙为新的重生。</p><p>  无限轮回这个象征永恒的主题，把剧情推向了高潮，“一切有什么意义呢”——哲学最终极的问题。不变的轮回有意义吗？不断衰减的轮回又有意义吗？到底哪种是毁灭，哪种才是救赎？</p><p>  知乎网友八云说：“大刘曾经表示过：他本来有意继续写三体，但是因为宝树的三体X的出现，他放弃了。”<br>网上骂声一片，被形容成毁掉了一个这么好的IP，也确实，本来对其预期极高，但看完之后，略感失望。<br>不过本书也是有一些亮点，例如对<strong>宇宙降维</strong>的原因，虽然解释的优点荒诞，但不得不说脑洞惊奇；再者 对<strong>歌者</strong>的继续出境，引出一段凄美婉转的爱情故事。<br>最大的一点对主角云天明的过大夸张，有点对其某种意义上的“意淫”，略有浮夸。</p><hr><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 阅读 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 阅读 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MJPG-Streamer推流测试</title>
      <link href="/2018/12/02/raspberry-mjpg/"/>
      <url>/2018/12/02/raspberry-mjpg/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/jacksonliam/mjpg-streamer" target="_blank" rel="noopener">mjpg-streamer Github</a></p><p><kbd><strong>用到的工具材料</strong>：</kbd></p><ul><li><input checked="" disabled="" type="checkbox"> 树莓派3B+</li><li><input checked="" disabled="" type="checkbox"> 网线</li><li><input checked="" disabled="" type="checkbox"> 电脑</li><li><input checked="" disabled="" type="checkbox"> CSI摄像头</li><li><input checked="" disabled="" type="checkbox"> USB摄像头</li></ul><blockquote><p>实现的功能有：<br>①树莓派通过网线将CSI摄像头与USB摄像头的实时画面推流至上位机电脑中的显示<br>②实测双摄延时低至200ms以下</p></blockquote><p>我的另一篇博文中介绍了使用树莓派H.264硬件编解码推流CSI摄像头，所以本文仅介绍如何用 MJPG-Streamer推流USB摄像头实时画面。所以需要同时推流双摄时，可选择CSI+USB Camera或者双USB Camera。</p><h1 id="总体流程"><a href="#总体流程" class="headerlink" title="总体流程"></a>总体流程</h1><p>1.树莓派硬件连接与软件及驱动安装<br>2.上位机PC端的接收视频流<br>3.延迟效果测试</p><h2 id="1-硬件连接与软件及驱动配置"><a href="#1-硬件连接与软件及驱动配置" class="headerlink" title="1.硬件连接与软件及驱动配置"></a>1.硬件连接与软件及驱动配置</h2><h3 id="1）检测是否存在USB摄像头设备"><a href="#1）检测是否存在USB摄像头设备" class="headerlink" title="1）检测是否存在USB摄像头设备"></a>1）检测是否存在USB摄像头设备</h3><p>输入以下指令：</p><pre><code>pi@raspberrypi:~ $ lsusb</code></pre><ul><li>未插入USB摄像头</li></ul><pre><code>pi@raspberrypi:~ $ lsusb Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet AdapterBus 001 Device 002: ID 0424:9514 Standard Microsystems Corp.Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre><ul><li>插入USB摄像头</li></ul><pre><code>pi@raspberrypi:~ $ lsusbBus 001 Device 004: ID 05a3:9230 ARC InternationalBus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet AdapterBus 001 Device 002: ID 0424:9514 Standard Microsystems Corp.Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre><pre><code>pi@raspberrypi:~ $ v4l2-ctl --list-formats</code></pre><pre><code>pi@raspberrypi:~ $ v4l2-ctl --list-formatsioctl: VIDIOC_ENUM_FMT        Index       : 0        Type        : Video Capture        Pixel Format: 'MJPG' (compressed)        Name        : Motion-JPEG        Index       : 1        Type        : Video Capture        Pixel Format: 'YUYV'        Name        : YUYV 4:2:2</code></pre><table>    <tbody><tr>        <td><center><img src="https://img-blog.csdnimg.cn/20181202170523751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70">图1  还未插入USB摄像头 </center></td>        <td><center><img src="https://img-blog.csdnimg.cn/20181202170531278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70">图2 插入USB摄像头</center></td></tr></tbody></table><h3 id="2）安装-MJPG-Streamer-from-github"><a href="#2）安装-MJPG-Streamer-from-github" class="headerlink" title="2）安装 MJPG-Streamer from github"></a>2）安装 MJPG-Streamer from github</h3><blockquote><p>按照以下命令安装MJPG-Streamer及其相关配置 每一行为一个命令</p></blockquote><pre><code>sudo apt-get install cmake libjpeg8-devwget https://github.com/jacksonliam/mjpg-streamer/archive/master.zipunzip master.zipcd mjp*g-*cd mjpg-*makesudo make installcd $home</code></pre><p>流程如下<br><img src="https://img-blog.csdnimg.cn/2018120219295880.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p><h3 id="3）启动MJPG-Streamer"><a href="#3）启动MJPG-Streamer" class="headerlink" title="3）启动MJPG-Streamer"></a>3）启动MJPG-Streamer</h3><blockquote><p>启动如下指令：<br>TCP端口8085被指定为输出端口，以确保没有对其他任何东西的干扰。</p></blockquote><pre><code>/usr/local/bin/mjpg_streamer -i "/usr/local/lib/mjpg-streamer/input_uvc.so -n -f 10 -r 1280x720" -o "/usr/local/lib/mjpg-streamer/output_http.so -p 8085 -w /usr/local/share/mjpg-streamer/www"</code></pre><p><img src="https://img-blog.csdnimg.cn/20181202185954705.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt="树莓派推流成功"></p><p><strong>如上图所示，推流已经完成，分辨率为720P(1280X720)，端口号为8085，到此树莓派的任务已经完成</strong></p><pre><code>pi@raspberrypi:~ $ /usr/local/bin/mjpg_streamer -i "/usr/local/lib/mjpg-streamer/input_uvc.so -n -f 10 -r 1280x720" -o "/usr/local/lib/mjpg-streamer/output_http.so -p 8085 -w /usr/local/share/mjpg-streamer/www"MJPG Streamer Version.: 2.0 i: Using V4L2 device.: /dev/video0 i: Desired Resolution: 1280 x 720 i: Frames Per Second.: 10 i: Format............: JPEG i: TV-Norm...........: DEFAULT i: FPS coerced ......: from 10 to 60 o: www-folder-path......: /usr/local/share/mjpg-streamer/www/ o: HTTP TCP port........: 8085 o: HTTP Listen Address..: (null) o: username:password....: disabled o: commands.............: enabled</code></pre><h3 id="4）开启指定摄像头"><a href="#4）开启指定摄像头" class="headerlink" title="4）开启指定摄像头"></a>4）开启指定摄像头</h3><ul><li>USB设备存在两个摄像头</li></ul><p><img src="https://img-blog.csdnimg.cn/20190507154817290.png" alt=""></p><ul><li>如果你有多个摄像头，也可以开启多个摄像头</li><li>-d /dev/video1    参数标明需要开启的摄像头</li></ul><pre><code>/usr/local/bin/mjpg_streamer -i "/usr/local/lib/mjpg-streamer/input_uvc.so -d /dev/video1 -n -f 10 -r 1280x720" -o "/usr/local/lib/mjpg-streamer/output_http.so -p 8085 -w /usr/local/share/mjpg-streamer/www"</code></pre><h2 id="2-上位机PC端的接收视频流"><a href="#2-上位机PC端的接收视频流" class="headerlink" title="2.上位机PC端的接收视频流"></a>2.上位机PC端的接收视频流</h2><blockquote><p>采用web网页接收视频流</p></blockquote><p>打开浏览器输入：</p><pre><code>http://树莓派ip地址:开启的端口号</code></pre><pre><code>// A case in point 例如：http://192.168.2.150:8085</code></pre><blockquote><p>输入 <a href="http://192.168.2.150:8085" target="_blank" rel="noopener">http://192.168.2.150:8085</a>   打开后如下图：为MJPG Streamer 首页<br><img src="https://img-blog.csdnimg.cn/20181202190911467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p></blockquote><ul><li>查看视频点击Stream<br><img src="https://img-blog.csdnimg.cn/20181202190927946.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></li></ul><p>看到网页中有树莓派USB摄像头拍摄的画面，证明视频推流成功。</p><h2 id="3-双摄延迟效果测试"><a href="#3-双摄延迟效果测试" class="headerlink" title="3.双摄延迟效果测试"></a>3.双摄延迟效果测试</h2><blockquote><p>我们打开一个在线秒表，让其开始计时，而后我们用树莓派CSI摄像头及USB摄像头去拍摄电脑屏幕，然后截屏，计算拍摄的时间与秒表实际时间的差值，可以粗略测得延时的结果</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20181202191338911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p><pre class=" language-javascript"><code class="language-javascript"><span class="token string">"如上图所示"</span>    在线秒表为<span class="token number">1.18</span><span class="token punctuation">.</span><span class="token number">697</span>  USB摄像头（Web MJPG<span class="token operator">-</span>Streamer）推流视频中的在线秒表为<span class="token number">1.18</span><span class="token punctuation">.</span><span class="token number">567</span>  CSI摄像头（MPlayer  视频播放器）推流视频中的在线秒表为<span class="token number">1.18</span><span class="token punctuation">.</span><span class="token number">525</span>其差值△t1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span>130s<span class="token operator">=</span>130ms                  △t1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span>172s<span class="token operator">=</span>172ms</code></pre><p>之后我通过多次测试多种组合得到如下图数据（仅做参考）：</p><p><img src="https://img-blog.csdnimg.cn/20181202192130874.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p><p>总结：</p><pre class=" language-javascript"><code class="language-javascript">   分辨率都为 720P  延迟大致为<span class="token number">100</span><span class="token operator">-</span>200ms之间<span class="token punctuation">[</span>带光纤延迟增加并不明显<span class="token punctuation">]</span>   分辨率都为 1080P 延迟为<span class="token number">200</span><span class="token operator">-</span>300ms</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry Pi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSI摄像头推流</title>
      <link href="/2018/11/28/raspberry-raspivid/"/>
      <url>/2018/11/28/raspberry-raspivid/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/jacksonliam/mjpg-streamer" target="_blank" rel="noopener">mjpg-streamer Github</a></p><p><kbd><strong>用到的工具材料</strong>：</kbd></p><ul><li><input checked="" disabled="" type="checkbox"> 树莓派3B+</li><li><input checked="" disabled="" type="checkbox"> 网线</li><li><input checked="" disabled="" type="checkbox"> 电脑</li><li><input checked="" disabled="" type="checkbox"> CSI摄像头</li><li><input checked="" disabled="" type="checkbox"> USB摄像头</li></ul><blockquote><p>实现的功能有：<br>①树莓派通过网线将CSI摄像头与USB摄像头的实时画面推流至上位机电脑中的显示<br>②实测双摄延时低至200ms以下</p></blockquote><p>我的另一篇博文中介绍了使用树莓派H.264硬件编解码推流CSI摄像头，所以本文仅介绍如何用 MJPG-Streamer推流USB摄像头实时画面。所以需要同时推流双摄时，可选择CSI+USB Camera或者双USB Camera。</p><table>    <tbody><tr>        <td><center><img src="https://img-blog.csdnimg.cn/20181128153213623.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70">图1  树莓派接线整体图 </center></td>        <td><center><img src="https://img-blog.csdnimg.cn/20181128154230707.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70">图2 树莓派接线整体图</center></td></tr></tbody></table><h1 id="总体流程"><a href="#总体流程" class="headerlink" title="总体流程"></a>总体流程</h1><p>1.树莓派硬件连接与软件及驱动安装<br>2.上位机PC端的接收视频流<br>3.延迟效果测试</p><h2 id="1-硬件连接与软件及驱动配置"><a href="#1-硬件连接与软件及驱动配置" class="headerlink" title="1.硬件连接与软件及驱动配置"></a>1.硬件连接与软件及驱动配置</h2><h3 id="1）检测是否存在USB摄像头设备"><a href="#1）检测是否存在USB摄像头设备" class="headerlink" title="1）检测是否存在USB摄像头设备"></a>1）检测是否存在USB摄像头设备</h3><p>输入以下指令：</p><pre><code>pi@raspberrypi:~ $ lsusb</code></pre><ul><li>未插入USB摄像头</li></ul><pre><code>pi@raspberrypi:~ $ lsusb Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet AdapterBus 001 Device 002: ID 0424:9514 Standard Microsystems Corp.Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre><ul><li>插入USB摄像头</li></ul><pre><code>pi@raspberrypi:~ $ lsusbBus 001 Device 004: ID 05a3:9230 ARC InternationalBus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet AdapterBus 001 Device 002: ID 0424:9514 Standard Microsystems Corp.Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre><pre><code>pi@raspberrypi:~ $ v4l2-ctl --list-formats</code></pre><pre><code>pi@raspberrypi:~ $ v4l2-ctl --list-formatsioctl: VIDIOC_ENUM_FMT        Index       : 0        Type        : Video Capture        Pixel Format: 'MJPG' (compressed)        Name        : Motion-JPEG        Index       : 1        Type        : Video Capture        Pixel Format: 'YUYV'        Name        : YUYV 4:2:2</code></pre><table>    <tbody><tr>        <td><center><img src="https://img-blog.csdnimg.cn/20181202170523751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70">图1  还未插入USB摄像头 </center></td>        <td><center><img src="https://img-blog.csdnimg.cn/20181202170531278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70">图2 插入USB摄像头</center></td></tr></tbody></table><h3 id="2）安装-MJPG-Streamer-from-github"><a href="#2）安装-MJPG-Streamer-from-github" class="headerlink" title="2）安装 MJPG-Streamer from github"></a>2）安装 MJPG-Streamer from github</h3><blockquote><p>按照以下命令安装MJPG-Streamer及其相关配置 每一行为一个命令</p></blockquote><pre><code>sudo apt-get install cmake libjpeg8-devwget https://github.com/jacksonliam/mjpg-streamer/archive/master.zipunzip master.zipcd mjp*g-*cd mjpg-*makesudo make installcd $home</code></pre><p>流程如下<br><img src="https://img-blog.csdnimg.cn/2018120219295880.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p><h3 id="3）启动MJPG-Streamer"><a href="#3）启动MJPG-Streamer" class="headerlink" title="3）启动MJPG-Streamer"></a>3）启动MJPG-Streamer</h3><blockquote><p>启动如下指令：<br>TCP端口8085被指定为输出端口，以确保没有对其他任何东西的干扰。</p></blockquote><pre><code>/usr/local/bin/mjpg_streamer -i "/usr/local/lib/mjpg-streamer/input_uvc.so -n -f 10 -r 1280x720" -o "/usr/local/lib/mjpg-streamer/output_http.so -p 8085 -w /usr/local/share/mjpg-streamer/www"</code></pre><p><img src="https://img-blog.csdnimg.cn/20181202185954705.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt="树莓派推流成功"></p><p><strong>如上图所示，推流已经完成，分辨率为720P(1280X720)，端口号为8085，到此树莓派的任务已经完成</strong></p><pre><code>pi@raspberrypi:~ $ /usr/local/bin/mjpg_streamer -i "/usr/local/lib/mjpg-streamer/input_uvc.so -n -f 10 -r 1280x720" -o "/usr/local/lib/mjpg-streamer/output_http.so -p 8085 -w /usr/local/share/mjpg-streamer/www"MJPG Streamer Version.: 2.0 i: Using V4L2 device.: /dev/video0 i: Desired Resolution: 1280 x 720 i: Frames Per Second.: 10 i: Format............: JPEG i: TV-Norm...........: DEFAULT i: FPS coerced ......: from 10 to 60 o: www-folder-path......: /usr/local/share/mjpg-streamer/www/ o: HTTP TCP port........: 8085 o: HTTP Listen Address..: (null) o: username:password....: disabled o: commands.............: enabled</code></pre><h3 id="4）开启指定-多个摄像头"><a href="#4）开启指定-多个摄像头" class="headerlink" title="4）开启指定/多个摄像头"></a>4）开启指定/多个摄像头</h3><ul><li>USB设备存在两个摄像头</li></ul><p><img src="https://img-blog.csdnimg.cn/20190507154817290.png" alt=""></p><ul><li>如果你有多个摄像头，也可以开启多个摄像头</li><li>-d /dev/video1    参数标明需要开启的摄像头</li></ul><pre><code>/usr/local/bin/mjpg_streamer -i "/usr/local/lib/mjpg-streamer/input_uvc.so -d /dev/video1 -n -f 10 -r 1280x720" -o "/usr/local/lib/mjpg-streamer/output_http.so -p 8085 -w /usr/local/share/mjpg-streamer/www"</code></pre><h2 id="2-上位机PC端的接收视频流"><a href="#2-上位机PC端的接收视频流" class="headerlink" title="2.上位机PC端的接收视频流"></a>2.上位机PC端的接收视频流</h2><blockquote><p>采用web网页接收视频流</p></blockquote><p>打开浏览器输入：</p><pre><code>http://树莓派ip地址:开启的端口号</code></pre><pre><code>// A case in point 例如：http://192.168.2.150:8085</code></pre><blockquote><p>输入 <a href="http://192.168.2.150:8085" target="_blank" rel="noopener">http://192.168.2.150:8085</a>   打开后如下图：为MJPG Streamer 首页<br><img src="https://img-blog.csdnimg.cn/20181202190911467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p></blockquote><ul><li>查看视频点击Stream</li></ul><p><img src="https://img-blog.csdnimg.cn/20181202190927946.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p><p>看到网页中有树莓派USB摄像头拍摄的画面，证明视频推流成功。</p><h2 id="3-双摄延迟效果测试"><a href="#3-双摄延迟效果测试" class="headerlink" title="3.双摄延迟效果测试"></a>3.双摄延迟效果测试</h2><blockquote><p>我们打开一个在线秒表，让其开始计时，而后我们用树莓派CSI摄像头及USB摄像头去拍摄电脑屏幕，然后截屏，计算拍摄的时间与秒表实际时间的差值，可以粗略测得延时的结果</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20181202191338911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p><p>“如上图所示”    在线秒表为1.18.697<br>USB摄像头（Web MJPG-Streamer）推流视频中的在线秒表为1.18.567<br>CSI摄像头（MPlayer  视频播放器）推流视频中的在线秒表为1.18.525<br>其差值△t1=0.130s=130ms                  △t1=0.172s=172ms</p><p>之后我通过多次测试多种组合得到如下图数据（仅做参考）：</p><p><img src="https://img-blog.csdnimg.cn/20181202192130874.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NDkyOTMy,size_16,color_FFFFFF,t_70" alt=""></p><p>总结：</p><pre><code>   分辨率都为 720P  延迟大致为100-200ms之间[带光纤延迟增加并不明显]   分辨率都为 1080P 延迟为200-300ms</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Raspberry Pi </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
